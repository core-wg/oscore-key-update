<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Key Update for OSCORE (KUDOS)</title>
<meta content="Rikard HÃ¶glund" name="author">
<meta content="Marco Tiloca" name="author">
<meta content="
       This document defines Key Update for OSCORE (KUDOS), a lightweight procedure that two CoAP endpoints can use to update their keying material by establishing a new OSCORE Security Context. Accordingly, it updates the use of the OSCORE flag bits in the CoAP OSCORE Option as well as the protection of CoAP response messages with OSCORE, and it deprecates the key update procedure specified in Appendix B.2 of RFC 8613. Thus, this document updates RFC 8613. Also, this document defines a procedure that two endpoints can use to update their OSCORE identifiers, run either stand-alone or during a KUDOS execution. 
    " name="description">
<meta content="xml2rfc 3.22.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-core-oscore-key-update-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.22.0
    Python 3.12.3
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.2.2
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 69.5.1
    wcwidth 0.2.13
-->
<link href="draft-ietf-core-oscore-key-update.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "â";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Key Update for OSCORE (KUDOS)</td>
<td class="right">August 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">HÃ¶glund &amp; Tiloca</td>
<td class="center">Expires 11 February 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-core-oscore-key-update-latest</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc8613" class="eref">8613</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-08-10" class="published">10 August 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-02-11">11 February 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. HÃ¶glund</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Key Update for OSCORE (KUDOS)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines Key Update for OSCORE (KUDOS), a lightweight procedure that two CoAP endpoints can use to update their keying material by establishing a new OSCORE Security Context. Accordingly, it updates the use of the OSCORE flag bits in the CoAP OSCORE Option as well as the protection of CoAP response messages with OSCORE, and it deprecates the key update procedure specified in Appendix B.2 of RFC 8613. Thus, this document updates RFC 8613. Also, this document defines a procedure that two endpoints can use to update their OSCORE identifiers, run either stand-alone or during a KUDOS execution.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">Â¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Constrained RESTful Environments Working Group mailing list (core@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/core/">https://mailarchive.ietf.org/arch/browse/core/</a></span>.<a href="#section-note.1-2" class="pilcrow">Â¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/core-wg/oscore-key-update">https://github.com/core-wg/oscore-key-update</a></span>.<a href="#section-note.1-3" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 11 February 2025.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.Â Â <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.Â Â <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.Â Â <a href="#name-current-methods-for-rekeyin" class="internal xref">Current Methods for Rekeying OSCORE</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.Â Â <a href="#name-updated-protection-of-respo" class="internal xref">Updated Protection of Responses with OSCORE</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.Â Â <a href="#name-key-update-for-oscore-kudos" class="internal xref">Key Update for OSCORE (KUDOS)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.Â Â <a href="#name-extensions-to-the-oscore-op" class="internal xref">Extensions to the OSCORE Option</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.Â Â <a href="#name-function-for-security-conte" class="internal xref">Function for Security Context Update</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.Â Â <a href="#name-key-update-with-forward-sec" class="internal xref">Key Update with Forward Secrecy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.Â Â <a href="#name-nonces-and-x-bytes" class="internal xref">Nonces and X Bytes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.Â Â <a href="#name-handling-of-oscore-security" class="internal xref">Handling of OSCORE Security Contexts</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.3">
                    <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="auto internal xref">4.3.3</a>.Â Â <a href="#name-handling-of-messages" class="internal xref">Handling of Messages</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.4">
                    <p id="section-toc.1-1.4.2.3.2.4.1"><a href="#section-4.3.4" class="auto internal xref">4.3.4</a>.Â Â <a href="#name-forward-message-flow" class="internal xref">Forward Message Flow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.5">
                    <p id="section-toc.1-1.4.2.3.2.5.1"><a href="#section-4.3.5" class="auto internal xref">4.3.5</a>.Â Â <a href="#name-reverse-message-flow" class="internal xref">Reverse Message Flow</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.Â Â <a href="#name-avoiding-deadlocks" class="internal xref">Avoiding Deadlocks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="auto internal xref">4.4.1</a>.Â Â <a href="#name-scenario-1" class="internal xref">Scenario 1</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="auto internal xref">4.4.2</a>.Â Â <a href="#name-scenario-2" class="internal xref">Scenario 2</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="auto internal xref">4.4.3</a>.Â Â <a href="#name-scenario-3" class="internal xref">Scenario 3</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.Â Â <a href="#name-key-update-with-or-without-" class="internal xref">Key Update with or without Forward Secrecy</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="auto internal xref">4.5.1</a>.Â Â <a href="#name-handling-and-use-of-keying-" class="internal xref">Handling and Use of Keying Material</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="auto internal xref">4.5.2</a>.Â Â <a href="#name-selection-of-kudos-mode" class="internal xref">Selection of KUDOS Mode</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.Â Â <a href="#name-preserving-observations-acr" class="internal xref">Preserving Observations Across Key Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.1">
                    <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="auto internal xref">4.6.1</a>.Â Â <a href="#name-management-of-observations" class="internal xref">Management of Observations</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.Â Â <a href="#name-retention-policies" class="internal xref">Retention Policies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.Â Â <a href="#name-discussion" class="internal xref">Discussion</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.1">
                    <p id="section-toc.1-1.4.2.8.2.1.1"><a href="#section-4.8.1" class="auto internal xref">4.8.1</a>.Â Â <a href="#name-kudos-interleaved-with-othe" class="internal xref">KUDOS Interleaved with Other Message Exchanges</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.2">
                    <p id="section-toc.1-1.4.2.8.2.2.1"><a href="#section-4.8.2" class="auto internal xref">4.8.2</a>.Â Â <a href="#name-communication-overhead" class="internal xref">Communication Overhead</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.3">
                    <p id="section-toc.1-1.4.2.8.2.3.1"><a href="#section-4.8.3" class="auto internal xref">4.8.3</a>.Â Â <a href="#name-well-known-kudos-resource" class="internal xref">Well-Known KUDOS Resource</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.4">
                    <p id="section-toc.1-1.4.2.8.2.4.1"><a href="#section-4.8.4" class="auto internal xref">4.8.4</a>.Â Â <a href="#name-rekeying-when-using-schc-wi" class="internal xref">Rekeying when Using SCHC with OSCORE</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="auto internal xref">4.9</a>.Â Â <a href="#name-signaling-kudos-support-in-" class="internal xref">Signaling KUDOS support in EDHOC</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.Â Â <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.Â Â <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.Â Â <a href="#name-oscore-flag-bits-registry" class="internal xref">OSCORE Flag Bits Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.Â Â <a href="#name-coap-option-numbers-registr" class="internal xref">CoAP Option Numbers Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.Â Â <a href="#name-edhoc-external-authorizatio" class="internal xref">EDHOC External Authorization Data Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.Â Â <a href="#name-the-well-known-uri-registry" class="internal xref">The Well-Known URI Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="auto internal xref">6.5</a>.Â Â <a href="#name-resource-type-rt-link-targe" class="internal xref">Resource Type (rt=) Link Target Attribute Values Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.Â Â <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.Â Â <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.Â Â <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.Â Â <a href="#name-forward-message-flow-using-" class="internal xref">Forward Message Flow using two CoAP Requests</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.Â Â <a href="#name-forward-message-flow-with-r" class="internal xref">Forward Message Flow with Response #1 unrelated to Request #1</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.Â Â <a href="#name-forward-message-flow-target" class="internal xref">Forward Message Flow Targeting a non-KUDOS Resource at Server</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.Â Â <a href="#name-document-updates" class="internal xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-D.1" class="auto internal xref">D.1</a>.Â Â <a href="#name-version-08-to-09" class="internal xref">Version -08 to -09</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-D.2" class="auto internal xref">D.2</a>.Â Â <a href="#name-version-07-to-08" class="internal xref">Version -07 to -08</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-D.3" class="auto internal xref">D.3</a>.Â Â <a href="#name-version-06-to-07" class="internal xref">Version -06 to -07</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#appendix-D.4" class="auto internal xref">D.4</a>.Â Â <a href="#name-version-05-to-06" class="internal xref">Version -05 to -06</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#appendix-D.5" class="auto internal xref">D.5</a>.Â Â <a href="#name-version-04-to-05" class="internal xref">Version -04 to -05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.6">
                <p id="section-toc.1-1.11.2.6.1"><a href="#appendix-D.6" class="auto internal xref">D.6</a>.Â Â <a href="#name-version-03-to-04" class="internal xref">Version -03 to -04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.7">
                <p id="section-toc.1-1.11.2.7.1"><a href="#appendix-D.7" class="auto internal xref">D.7</a>.Â Â <a href="#name-version-02-to-03" class="internal xref">Version -02 to -03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.8">
                <p id="section-toc.1-1.11.2.8.1"><a href="#appendix-D.8" class="auto internal xref">D.8</a>.Â Â <a href="#name-version-01-to-02" class="internal xref">Version -01 to -02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.9">
                <p id="section-toc.1-1.11.2.9.1"><a href="#appendix-D.9" class="auto internal xref">D.9</a>.Â Â <a href="#name-version-00-to-01" class="internal xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> provides end-to-end protection of CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> messages at the application-layer, ensuring message confidentiality and integrity, replay protection, as well as binding of response to request between a sender and a recipient.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2">To ensure secure communication when using OSCORE, peers may need to update their shared keying material. Among other reasons, approaching key usage limits <span>[<a href="#I-D.irtf-cfrg-aead-limits" class="cite xref">I-D.irtf-cfrg-aead-limits</a>]</span><span>[<a href="#I-D.ietf-core-oscore-key-limits" class="cite xref">I-D.ietf-core-oscore-key-limits</a>]</span> requires updating the OSCORE keying material before communications can securely continue.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">This document updates <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> as follows.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">
          <p id="section-1-4.1.1">It specifies KUDOS, a lightweight key update procedure that the two peers can use in order to update their current keying material and establish a new OSCORE Security Context. This deprecates and replaces the procedure specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-1-4.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-1-4.2">
          <p id="section-1-4.2.1">With reference to the "OSCORE Flag Bits" registry defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-13.7" class="relref">Section 13.7</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> as part of the "Constrained RESTful Environments (CoRE) Parameters" registry group, it updates the entries with Bit Position 0 and 1 (see <a href="#sec-iana" class="auto internal xref">Section 6</a>), both originally marked as "Reserved". That is, it defines and registers the usage of the OSCORE flag bit with Bit Position 0, as the one intended to expand the space for the OSCORE flag bits in the OSCORE Option (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>). Also, it marks the bit with Bit Position of 1 as "Unassigned".<a href="#section-1-4.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-1-4.3">
          <p id="section-1-4.3.1">It updates the protection of CoAP responses with OSCORE originally specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.3" class="relref">Section 8.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, as defined in <a href="#sec-updated-response-protection" class="auto internal xref">Section 3</a> of this document.<a href="#section-1-4.3.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-1-5">Furthermore, this document specifies a method that two peers can use to update their OSCORE identifiers. This can be run as a stand-alone procedure, or instead integrated in a KUDOS execution.<a href="#section-1-5" class="pilcrow">Â¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCPÂ 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts related to CoAP <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, and EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-1.1-2" class="pilcrow">Â¶</a></p>
<p id="section-1.1-3">This document additionally defines the following terminology.<a href="#section-1.1-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">
            <p id="section-1.1-4.1.1">Initiator: the peer starting the KUDOS execution, by sending the first KUDOS message.<a href="#section-1.1-4.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.2">
            <p id="section-1.1-4.2.1">Responder: the peer that receives the first KUDOS message in a KUDOS execution.<a href="#section-1.1-4.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.3">
            <p id="section-1.1-4.3.1">Forward message flow: the KUDOS execution workflow where the initiator acts as CoAP client (see <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>).<a href="#section-1.1-4.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.4">
            <p id="section-1.1-4.4.1">Reverse message flow: the KUDOS execution workflow where the initiator acts as CoAP server (see <a href="#ssec-derive-ctx-server-init" class="auto internal xref">Section 4.3.5</a>).<a href="#section-1.1-4.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.5">
            <p id="section-1.1-4.5.1">FS mode: the KUDOS execution mode that achieves forward secrecy (see <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>).<a href="#section-1.1-4.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-1.1-4.6">
            <p id="section-1.1-4.6.1">No-FS mode: the KUDOS execution mode that does not achieve forward secrecy (see <a href="#no-fs-mode" class="auto internal xref">Section 4.5</a>).<a href="#section-1.1-4.6.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-current-methods">
<section id="section-2">
      <h2 id="name-current-methods-for-rekeyin">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-current-methods-for-rekeyin" class="section-name selfRef">Current Methods for Rekeying OSCORE</a>
      </h2>
<p id="section-2-1">Two peers communicating using OSCORE may choose to renew their shared keying information by establishing a new OSCORE Security Context for a variety of reasons. A particular reason is approaching limits set for safe key usage <span>[<a href="#I-D.ietf-core-oscore-key-limits" class="cite xref">I-D.ietf-core-oscore-key-limits</a>]</span>. Practically, when the relevant limits have been reached for an OSCORE Security Context, the two peers have to establish a new OSCORE Security Context, in order to continue using OSCORE for secure communication. That is, the two peers have to establish new Sender and Recipient Keys, as the keys actually used by the AEAD algorithm.<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2">In addition to approaching the key usage limits, there may be other reasons for a peer to initiate a key update procedure. These include: the OSCORE Security Context approaching its expiration time; application policies prescribing a regular key rollover; approaching the exhaustion of the Sender Sequence Number space in the OSCORE Sender Context.<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<p id="section-2-3">It is <span class="bcp14">RECOMMENDED</span> that the peer initiating the key update procedure starts it with some margin, i.e., well before actually experiencing the trigger event forcing to perform a key update, e.g., the OSCORE Security Context expiration or the exhaustion of the Sender Sequence Number space. If the rekeying is not initiated ahead of these events, it may become practically impossible to perform a key update with certain methods.<a href="#section-2-3" class="pilcrow">Â¶</a></p>
<p id="section-2-4">Other specifications define a number of ways for rekeying OSCORE, as summarized below.<a href="#section-2-4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">
          <p id="section-2-5.1.1">The two peers can run the procedure defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. That is, the two peers exchange three or four messages, protected with temporary Security Contexts adding randomness to the ID Context.<a href="#section-2-5.1.1" class="pilcrow">Â¶</a></p>
<p id="section-2-5.1.2">
As a result, the two peers establish a new OSCORE Security Context with new ID Context, Sender Key, and Recipient Key, while keeping the same OSCORE Master Secret and OSCORE Master Salt from the old OSCORE Security Context.<a href="#section-2-5.1.2" class="pilcrow">Â¶</a></p>
<p id="section-2-5.1.3">
This procedure does not require any additional components to what OSCORE already provides, and it does not provide forward secrecy.<a href="#section-2-5.1.3" class="pilcrow">Â¶</a></p>
<p id="section-2-5.1.4">
The procedure defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> is used in 6TiSCH networks <span>[<a href="#RFC7554" class="cite xref">RFC7554</a>]</span><span>[<a href="#RFC8180" class="cite xref">RFC8180</a>]</span> when handling failure events. That is, a node acting as Join Registrar/Coordinator (JRC) assists new devices, namely "pledges", to securely join the network as per the Constrained Join Protocol <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>. In particular, a pledge exchanges OSCORE-protected messages with the JRC, from which it obtains a short identifier, link-layer keying material and other configuration parameters. As per <span><a href="https://rfc-editor.org/rfc/rfc9031#section-8.3.3" class="relref">Section 8.3.3</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>, a JRC that experiences a failure event may likely lose information about joined nodes, including their assigned identifiers. Then, the reinitialized JRC can establish a new OSCORE Security Context with each pledge, through the procedure defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2-5.1.4" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-2-5.2">
          <p id="section-2-5.2.1">The two peers can run the OSCORE profile <span>[<a href="#RFC9203" class="cite xref">RFC9203</a>]</span> of the Authentication and Authorization for Constrained Environments (ACE) Framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-2-5.2.1" class="pilcrow">Â¶</a></p>
<p id="section-2-5.2.2">
When a CoAP client uploads an Access Token to a CoAP server as an access credential, the two peers also exchange two nonces. Then, the two peers use the two nonces together with information provided by the ACE Authorization Server that issued the Access Token, in order to derive an OSCORE Security Context.<a href="#section-2-5.2.2" class="pilcrow">Â¶</a></p>
<p id="section-2-5.2.3">
This procedure does not provide forward secrecy.<a href="#section-2-5.2.3" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-2-5.3">
          <p id="section-2-5.3.1">The two peers can run the EDHOC key exchange protocol based on Diffie-Hellman and defined in <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, in order to establish a pseudo-random key in a mutually authenticated way.<a href="#section-2-5.3.1" class="pilcrow">Â¶</a></p>
<p id="section-2-5.3.2">
Then, the two peers can use the established pseudo-random key to derive external application keys. This allows the two peers to securely derive an OSCORE Master Secret and an OSCORE Master Salt, from which an OSCORE Security Context can be established.<a href="#section-2-5.3.2" class="pilcrow">Â¶</a></p>
<p id="section-2-5.3.3">
This procedure additionally provides forward secrecy.<a href="#section-2-5.3.3" class="pilcrow">Â¶</a></p>
<p id="section-2-5.3.4">
EDHOC also specifies an optional function, EDHOC_KeyUpdate, to perform a key update in a more efficient way than re-running EDHOC. The two communicating peers call EDHOC_KeyUpdate with equivalent input, which results in derivation of a new shared pseudo-random key. Usage of EDHOC_KeyUpdate preserves forward secrecy.<a href="#section-2-5.3.4" class="pilcrow">Â¶</a></p>
<p id="section-2-5.3.5">
Note that EDHOC may be run standalone or as part of other workflows, such as when using the EDHOC and OSCORE profile of ACE <span>[<a href="#I-D.ietf-ace-edhoc-oscore-profile" class="cite xref">I-D.ietf-ace-edhoc-oscore-profile</a>]</span>.<a href="#section-2-5.3.5" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-2-5.4">
          <p id="section-2-5.4.1">If one peer is acting as LwM2M Client and the other peer as LwM2M Server, according to the OMA Lightweight Machine to Machine Core specification <span>[<a href="#LwM2M" class="cite xref">LwM2M</a>]</span>, then the LwM2M Client peer may take the initiative to bootstrap again with the LwM2M Bootstrap Server, and receive again an OSCORE Security Context. Alternatively, the LwM2M Server can instruct the LwM2M Client to initiate this procedure.<a href="#section-2-5.4.1" class="pilcrow">Â¶</a></p>
<p id="section-2-5.4.2">
If the OSCORE Security Context information on the LwM2M Bootstrap Server has been updated, the LwM2M Client will thus receive a fresh OSCORE Security Context to use with the LwM2M Server.<a href="#section-2-5.4.2" class="pilcrow">Â¶</a></p>
<p id="section-2-5.4.3">
In addition to that, the LwM2M Client, the LwM2M Server as well as the LwM2M Bootstrap server are required to use the procedure defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and overviewed above, when they use a certain OSCORE Security Context for the first time <span>[<a href="#LwM2M-Transport" class="cite xref">LwM2M-Transport</a>]</span>.<a href="#section-2-5.4.3" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-2-6">Manually updating the OSCORE Security Context at the two peers should be a last resort option, and it might often be not practical or feasible.<a href="#section-2-6" class="pilcrow">Â¶</a></p>
<p id="section-2-7">Even when any of the alternatives mentioned above is available, it is <span class="bcp14">RECOMMENDED</span> that two OSCORE peers update their Security Context by using the KUDOS procedure as defined in <a href="#sec-rekeying-method" class="auto internal xref">Section 4</a> of this document.<a href="#section-2-7" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sec-updated-response-protection">
<section id="section-3">
      <h2 id="name-updated-protection-of-respo">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-updated-protection-of-respo" class="section-name selfRef">Updated Protection of Responses with OSCORE</a>
      </h2>
<p id="section-3-1">The protection of CoAP responses with OSCORE is updated, by adding the following text at the end of step 3 of <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.3" class="relref">Section 8.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-3-1" class="pilcrow">Â¶</a></p>
<blockquote id="section-3-2">
        <p id="section-3-2.1">If the server is using a different Security Context for the response compared to what was used to verify the request (e.g., due to an occurred key update), then the server <span class="bcp14">MUST</span> take the second alternative. That is, the server <span class="bcp14">MUST</span> include its Sender Sequence Number as Partial IV in the response and use it to build the AEAD nonce to protect the response.<a href="#section-3-2.1" class="pilcrow">Â¶</a></p>
<p id="section-3-2.2">This prevents the server from using the same AEAD (key, nonce) pair for two responses, protected with different OSCORE Security Contexts. An exception is the procedure in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, which is secure although not complying with the above.<a href="#section-3-2.2" class="pilcrow">Â¶</a></p>
</blockquote>
</section>
</div>
<div id="sec-rekeying-method">
<section id="section-4">
      <h2 id="name-key-update-for-oscore-kudos">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-key-update-for-oscore-kudos" class="section-name selfRef">Key Update for OSCORE (KUDOS)</a>
      </h2>
<p id="section-4-1">This section defines KUDOS, a lightweight procedure that two OSCORE peers can use to update their keying material and establish a new OSCORE Security Context.<a href="#section-4-1" class="pilcrow">Â¶</a></p>
<p id="section-4-2">KUDOS relies on the OSCORE Option defined in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and extended as defined in <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>, as well as on the support function updateCtx() defined in <a href="#ssec-update-function" class="auto internal xref">Section 4.2</a>.<a href="#section-4-2" class="pilcrow">Â¶</a></p>
<p id="section-4-3">In order to run KUDOS, two peers perform a message exchange of OSCORE-protected CoAP messages. This message exchange between the two peers is defined in <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>, with particular reference to the stateful FS mode providing forward secrecy. Building on the same message exchange, the possible use of the stateless no-FS mode is defined in <a href="#no-fs-mode" class="auto internal xref">Section 4.5</a>, as intended to peers that are not able to write in non-volatile memory. Two peers <span class="bcp14">MUST</span> run KUDOS in FS mode if they are both capable to.<a href="#section-4-3" class="pilcrow">Â¶</a></p>
<p id="section-4-4">The key update procedure has the following properties.<a href="#section-4-4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-5.1">
          <p id="section-4-5.1.1">KUDOS can be initiated by either peer. In particular, the CoAP client or the CoAP server may start KUDOS by sending the first rekeying message, by running KUDOS in the forward message flow <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a> or reverse message flow <a href="#ssec-derive-ctx-server-init" class="auto internal xref">Section 4.3.5</a>, respectively. A peer that supports KUDOS <span class="bcp14">MUST</span> support both the forward message flow and the reverse message flow.<a href="#section-4-5.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-5.2">
          <p id="section-4-5.2.1">The new OSCORE Security Context enjoys forward secrecy, unless KUDOS is run in no-FS mode (see <a href="#no-fs-mode" class="auto internal xref">Section 4.5</a>).<a href="#section-4-5.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-5.3">
          <p id="section-4-5.3.1">The same ID Context value used in the old OSCORE Security Context is preserved in the new Security Context. Furthermore, the ID Context value never changes throughout the KUDOS execution.<a href="#section-4-5.3.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-5.4">
          <p id="section-4-5.4.1">KUDOS is robust against a peer rebooting, and it especially avoids the reuse of AEAD (nonce, key) pairs.<a href="#section-4-5.4.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-5.5">
          <p id="section-4-5.5.1">KUDOS completes in one round trip by exchanging two CoAP messages. The two peers achieve mutual key confirmation in the following exchange, which is protected with the newly established OSCORE Security Context.<a href="#section-4-5.5.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<div id="ssec-oscore-option-extensions">
<section id="section-4.1">
        <h3 id="name-extensions-to-the-oscore-op">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-extensions-to-the-oscore-op" class="section-name selfRef">Extensions to the OSCORE Option</a>
        </h3>
<p id="section-4.1-1">In order to support the message exchange for establishing a new OSCORE Security Context, this document extends the use of the OSCORE Option originally defined in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> as follows.<a href="#section-4.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">This document defines the usage of the eight least significant bit, called "Extension-1 Flag", in the first byte of the OSCORE Option containing the OSCORE flag bits. The registration of this flag bit in the "OSCORE Flag Bits" registry is specified in <a href="#iana-cons-flag-bits" class="auto internal xref">Section 6.1</a>.<a href="#section-4.1-2.1.1" class="pilcrow">Â¶</a></p>
<p id="section-4.1-2.1.2">
When the Extension-1 Flag is set to 1, the second byte of the OSCORE Option <span class="bcp14">MUST</span> include the OSCORE flag bits 8-15.<a href="#section-4.1-2.1.2" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">This document defines the usage of the least significant bit "Nonce Flag", 'd', in the second byte of the OSCORE Option containing the OSCORE flag bits 8-15. This flag bit is specified in <a href="#iana-cons-flag-bits" class="auto internal xref">Section 6.1</a>.<a href="#section-4.1-2.2.1" class="pilcrow">Â¶</a></p>
<p id="section-4.1-2.2.2">
When it is set to 1, the compressed COSE object contains a field 'x' and a field 'nonce', to be used for the steps defined in <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>. In particular, the 1 byte 'x' following 'kid context' (if any) encodes the size of the following field 'nonce', together with signaling bits that indicate the specific behavior to adopt during the KUDOS execution.<a href="#section-4.1-2.2.2" class="pilcrow">Â¶</a></p>
<p id="section-4.1-2.2.3">
Hereafter, a message is referred to as a "KUDOS (request/response) message", if and only if the second byte of flags is present and the 'd' bit is set to 1. If that is not the case, the message is referred to as a "non KUDOS (request/response) message".<a href="#section-4.1-2.2.3" class="pilcrow">Â¶</a></p>
<p id="section-4.1-2.2.4">
The encoding of 'x' is as follows:<a href="#section-4.1-2.2.4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.2.5.1">
                <p id="section-4.1-2.2.5.1.1">The four least significant bits encode the 'nonce' size in bytes minus 1, namely 'm'.<a href="#section-4.1-2.2.5.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.5.2">
                <p id="section-4.1-2.2.5.2.1">The fifth least significant bit is the "No Forward Secrecy" 'p' bit. The sender peer indicates its wish to run KUDOS in FS mode or in no-FS mode, by setting the 'p' bit to 0 or 1, respectively. This makes KUDOS possible to run also for peers that cannot support the FS mode. At the same time, two peers <span class="bcp14">MUST</span> run KUDOS in FS mode if they are both capable to, as per <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>. The execution of KUDOS in no-FS mode is defined in <a href="#no-fs-mode" class="auto internal xref">Section 4.5</a>.<a href="#section-4.1-2.2.5.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.5.3">
                <p id="section-4.1-2.2.5.3.1">The sixth least significant bit is the "Preserve Observations" 'b' bit. The sender peer indicates its wish to preserve ongoing observations beyond the KUDOS execution or not, by setting the 'b' bit to 1 or 0, respectively. The related processing is defined in <a href="#preserving-observe" class="auto internal xref">Section 4.6</a>.<a href="#section-4.1-2.2.5.3.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.5.4">
                <p id="section-4.1-2.2.5.4.1">The seventh least significant bit is the 'z' bit. When it is set to 1, the compressed COSE object contains a field 'y' and a field 'old_nonce', to be used for the steps defined in <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>. In particular, the 1 byte 'y' following 'nonce' encodes the size of the following field 'old_nonce'. This bit <span class="bcp14">SHALL</span> only be set in the second KUDOS message and only if it is a CoAP request. For an example see the execution of KUDOS in the reverse message flow shown in <a href="#fig-message-exchange-server-init" class="auto internal xref">Figure 6</a>.<a href="#section-4.1-2.2.5.4.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.5.5">
                <p id="section-4.1-2.2.5.5.1">The eight least significant bit is reserved for future use. This bit <span class="bcp14">SHALL</span> be set to zero when not in use. According to this specification, if this bit is set to 1, the message is considered to be malformed and decompression fails as specified in item 2 of <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-4.1-2.2.5.5.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
<p id="section-4.1-2.2.6">
The encoding of 'y' is as follows:<a href="#section-4.1-2.2.6" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.2.7.1">
                <p id="section-4.1-2.2.7.1.1">The four least significant bits of the 'y' byte encode the 'old_nonce' size in bytes minus 1, namely 'w'.<a href="#section-4.1-2.2.7.1.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.7.2">
                <p id="section-4.1-2.2.7.2.1">The fifth to seventh least significant bits <span class="bcp14">SHALL</span> be set to zero when not in use. According to this specification, if these bits are set to 1, the message is considered to be malformed and decompression fails as specified in item 2 of <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span><a href="#section-4.1-2.2.7.2.1" class="pilcrow">Â¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.2.7.3">
                <p id="section-4.1-2.2.7.3.1">The eight least significant bit is reserved for future use. This bit <span class="bcp14">SHALL</span> be set to zero when not in use. According to this specification, if this bit is set to 1, the message is considered to be malformed and decompression fails as specified in item 2 of <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-4.1-2.2.7.3.1" class="pilcrow">Â¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.1-2.3">
            <p id="section-4.1-2.3.1">The second-to-eighth least significant bits in the second byte of the OSCORE Option containing the OSCORE flag bits are reserved for future use. These bits <span class="bcp14">SHALL</span> be set to zero when not in use. According to this specification, if any of these bits are set to 1, the message is considered to be malformed and decompression fails as specified in item 2 of <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-4.1-2.3.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-4.1-3"><a href="#fig-oscore-option" class="auto internal xref">Figure 1</a> shows extended OSCORE Option value, with the possible presence of 'nonce' and 'old_nonce'.<a href="#section-4.1-3" class="pilcrow">Â¶</a></p>
<span id="name-the-extended-oscore-option-"></span><div id="fig-oscore-option">
<figure id="figure-1">
          <div class="alignCenter art-text artwork" id="section-4.1-4.1">
<pre>
 0 1 2 3 4 5 6 7  8   9   10  11  12  13  14  15 &lt;----- n bytes -----&gt;
+-+-+-+-+-+-+-+-+---+---+---+---+---+---+---+---+---------------------+
|1|0|0|h|k|  n  | 0 | 0 | 0 | 0 | 0 | 0 | 0 | d | Partial IV (if any) |
+-+-+-+-+-+-+-+-+---+---+---+---+---+---+---+---+---------------------+


 &lt;- 1 byte -&gt; &lt;----- s bytes ------&gt; &lt;- 1 byte -&gt; &lt;--- m + 1 bytes ---&gt;
+------------+----------------------+------------+--------------------+
| s (if any) | kid context (if any) | x (if any) | nonce (if any)     |
+------------+----------------------+------------+--------------------+
                                   /              \____
                                  /                    |
                                 /   0 1 2 3 4 5 6 7   |
                                 |  +-+-+-+-+-+-+-+-+  |
                                 |  |0|z|b|p|   m   |  |
                                 |  +-+-+-+-+-+-+-+-+  |

    &lt;- 1 byte -&gt; &lt;--- w + 1 bytes ---&gt;
   +------------+---------------------+------------------+
   | y (if any) | old_nonce (if any)  | kid (if any) ... |
   +------------+---------------------+------------------+
  /              \____
 /                    |
/   0 1 2 3 4 5 6 7   |
|  +-+-+-+-+-+-+-+-+  |
|  |0|0|0|0|   w   |  |
|  +-+-+-+-+-+-+-+-+  |
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-the-extended-oscore-option-" class="selfRef">The extended OSCORE Option value, with the possible presence of 'nonce' and 'old\_nonce'</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-update-function">
<section id="section-4.2">
        <h3 id="name-function-for-security-conte">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-function-for-security-conte" class="section-name selfRef">Function for Security Context Update</a>
        </h3>
<p id="section-4.2-1">The updateCtx() function shown in <a href="#function-update" class="auto internal xref">Figure 2</a> takes as input the three parameters X, N, and CTX_IN. In particular, X and N are built from the 'x' and 'nonce' fields transported in the OSCORE Option value of the exchanged KUDOS messages (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>), while CTX_IN is the OSCORE Security Context to update. The function returns a new OSCORE Security Context CTX_OUT.<a href="#section-4.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.2-2">As a first step, the updateCtx() function builds the two CBOR byte strings X_cbor and N_cbor, with value the input parameter X and N, respectively. Then, it builds X_N, as the byte concatenation of X_cbor and N_cbor.<a href="#section-4.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.2-3">After that, the updateCtx() function derives the new values of the Master Secret and Master Salt for CTX_OUT. In particular, the new Master Secret is derived through a KUDOS-Expand() step, which takes as input the Master Secret value from the Security Context CTX_IN, the literal string "key update", X_N, and the length of the Master Secret. Instead, the new Master Salt takes N as value.<a href="#section-4.2-3" class="pilcrow">Â¶</a></p>
<p id="section-4.2-4">The definition of KUDOS-Expand depends on the key derivation function used for OSCORE by the two peers, as specified in CTX_IN.
either peer
   If the key derivation function is an HKDF Algorithm (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), then KUDOS-Expand is mapped to HKDF-Expand <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>, as shown below. Also, the hash algorithm is the same one used by the HKDF Algorithm specified in CTX_IN.<a href="#section-4.2-4" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-5">
<pre>
     KUDOS-Expand(CTX_IN.MasterSecret, ExpandLabel, oscore_key_length) =
        HKDF-Expand(CTX_IN.MasterSecret, ExpandLabel, oscore_key_length)
</pre><a href="#section-4.2-5" class="pilcrow">Â¶</a>
</div>
<p id="section-4.2-6">If a future specification updates <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> by admitting different key derivation functions than HKDF Algorithms (e.g., KMAC as based on the SHAKE128 or SHAKE256 hash functions), that specification has to update also the present document in order to define the mapping between such key derivation functions and KUDOS-Expand.<a href="#section-4.2-6" class="pilcrow">Â¶</a></p>
<p id="section-4.2-7">When an HKDF Algorithm is used, the derivation of new values follows the same approach used in TLS 1.3, which is also based on HKDF-Expand (see <span><a href="https://rfc-editor.org/rfc/rfc8446#section-7.1" class="relref">Section 7.1</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>) and used for computing new keying material in case of key update (see <span><a href="https://rfc-editor.org/rfc/rfc8446#section-4.6.3" class="relref">Section 4.6.3</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>).<a href="#section-4.2-7" class="pilcrow">Â¶</a></p>
<p id="section-4.2-8">After that, the new Master Secret and Master Salt parameters are used to derive a new Security Context CTX_OUT as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Any other parameter required for the derivation takes the same value as in the Security Context CTX_IN.<a href="#section-4.2-8" class="pilcrow">Â¶</a></p>
<p id="section-4.2-9">Note that the following holds for the newly derived CTX_OUT:<a href="#section-4.2-9" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-10.1">
            <p id="section-4.2-10.1.1">In its Sender Context, the Sender Sequence Number is initialized to 0 as per <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.2" class="relref">Section 3.2.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-4.2-10.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.2-10.2">
            <p id="section-4.2-10.2.1">If the peer that has derived CTX_OUT supports CoAP Observe <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, the Notification Number used for the replay protection of Observe notifications (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-7.4.1" class="relref">Section 7.4.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>) is left as not initialized.<a href="#section-4.2-10.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-4.2-11">Finally, the updateCtx() function returns the newly derived Security Context CTX_OUT.<a href="#section-4.2-11" class="pilcrow">Â¶</a></p>
<p id="section-4.2-12">Since the updateCtx() function also takes X as input, the derivation of CTX_OUT also considers as input the information from the 'x' field transported in the OSCORE Option value of the exchanged KUDOS messages. In turn, this ensures that, if successfully completed, a KUDOS execution occurs as intended by the two peers.<a href="#section-4.2-12" class="pilcrow">Â¶</a></p>
<span id="name-function-for-deriving-a-new"></span><div id="function-update">
<figure id="figure-2">
          <div class="alignCenter art-text artwork" id="section-4.2-13.1">
<pre>
updateCtx(X, N, CTX_IN) {

  CTX_OUT       // The new Security Context
  MSECRET_NEW   // The new Master Secret
  MSALT_NEW     // The new Master Salt

  X_cbor = bstr .cbor X // CBOR bstr wrapping of X
  N_cbor = bstr .cbor N // CBOR bstr wrapping of N

  X_N = X_cbor | N_cbor

  oscore_key_length = &lt; Size of CTX_IN.MasterSecret in bytes &gt;

  Label = "key update"

  MSECRET_NEW = KUDOS-Expand-Label(CTX_IN.MasterSecret, Label,
                                   X_N, oscore_key_length)
               = KUDOS-Expand(CTX_IN.MasterSecret, ExpandLabel,
                              oscore_key_length)

  MSALT_NEW = N;

  &lt; Derive CTX_OUT using MSECRET_NEW and MSALT_NEW,
    together with other parameters from CTX_IN &gt;

  Return CTX_OUT;

}

Where ExpandLabel is defined as

struct {
    uint16 length = oscore_key_length;
    opaque label&lt;7..255&gt; = "oscore " + Label;
    opaque context&lt;0..255&gt; = X_N;
} ExpandLabel;
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-function-for-deriving-a-new" class="selfRef">Function for deriving a new OSCORE Security Context</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-derive-ctx">
<section id="section-4.3">
        <h3 id="name-key-update-with-forward-sec">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-key-update-with-forward-sec" class="section-name selfRef">Key Update with Forward Secrecy</a>
        </h3>
<p id="section-4.3-1">This section defines the actual KUDOS procedure performed by two peers to update their OSCORE keying material.<a href="#section-4.3-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3-2">A peer can run KUDOS for active rekeying at any time, or for a variety of more compelling reasons. These include the (approaching) expiration of the OSCORE Security Context, approaching limits for the key usage <span>[<a href="#I-D.ietf-core-oscore-key-limits" class="cite xref">I-D.ietf-core-oscore-key-limits</a>]</span>, application policies, and imminent exhaustion of the OSCORE Sender Sequence Number space.<a href="#section-4.3-2" class="pilcrow">Â¶</a></p>
<p id="section-4.3-3">The expiration time of an OSCORE Security Context and the key usage limits are hard limits. Once reached them, a peer <span class="bcp14">MUST</span> stop using the keying material in the OSCORE Security Context for conventional communication with the other peer, and has to perform a rekeying before resuming secure communication.<a href="#section-4.3-3" class="pilcrow">Â¶</a></p>
<p id="section-4.3-4">Before starting KUDOS, the two peers share the OSCORE Security Context CTX_OLD. Once successfully completed the KUDOS execution, the two peers agree on a newly established OSCORE Security Context CTX_NEW.<a href="#section-4.3-4" class="pilcrow">Â¶</a></p>
<p id="section-4.3-5">In particular, CTX_OLD is the most recent OSCORE Security Context that a peer has with a given ID Context or without ID Context, before initiating the KUDOS procedure or upon having received and successfully verified the first KUDOS message. In turn, CTX_NEW is the most recent OSCORE Security Context that a peer has with a given ID Context or without ID Context, before sending the second KUDOS message or upon having received and successfully verified the second KUDOS message.<a href="#section-4.3-5" class="pilcrow">Â¶</a></p>
<p id="section-4.3-6">The following specifically defines how KUDOS is run in its stateful FS mode achieving forward secrecy. That is, in the OSCORE Option value of all the exchanged KUDOS messages, the "No Forward Secrecy" bit is set to 0.<a href="#section-4.3-6" class="pilcrow">Â¶</a></p>
<p id="section-4.3-7">In order to run KUDOS in FS mode, both peers have to be able to write in non-volatile memory. From the newly derived Security Context CTX_NEW, the peers <span class="bcp14">MUST</span> store to non-volatile memory the immutable parts of the OSCORE Security Context as specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, with the possible exception of the Common IV, Sender Key, and Recipient Key that can be derived again when needed, as specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. If the peer is unable to write in non-volatile memory, the two peers have to run KUDOS in its stateless no-FS mode (see <a href="#no-fs-mode" class="auto internal xref">Section 4.5</a>).<a href="#section-4.3-7" class="pilcrow">Â¶</a></p>
<div id="ssec-nonces-x-bytes">
<section id="section-4.3.1">
          <h4 id="name-nonces-and-x-bytes">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-nonces-and-x-bytes" class="section-name selfRef">Nonces and X Bytes</a>
          </h4>
<p id="section-4.3.1-1">When running KUDOS, each peer contributes by generating a nonce value N1 or N2, and providing it to the other peer. The size of the nonces N1 and N2 is application specific, and the use of 8 byte nonce values is <span class="bcp14">RECOMMENDED</span>. The nonces N1 and N2 <span class="bcp14">SHOULD</span> be random values. An exception is described later in <a href="#key-material-handling" class="auto internal xref">Section 4.5.1</a>.<a href="#section-4.3.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.1-2">Furthermore, X1 and X2 are the value of the 'x' byte specified in the OSCORE Option of the first and second KUDOS message, respectively. The X1 and X2 values are calculated by the sender peer based on: the length of nonce N1 and N2, specified in the 'nonce' field of the OSCORE Option of the first and second KUDOS message, respectively; as well as on the specific settings the peer wishes to run KUDOS with. As defined in <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>, these values are used by the peers to build the input N and X to the updateCtx() function, in order to derive a new OSCORE Security Context. As for any new OSCORE Security Context, the Sender Sequence Number and the Replay Window are re-initialized accordingly (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.2" class="relref">Section 3.2.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).<a href="#section-4.3.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.3.1-3">After a peer has generated or received the value N1, and after a peer has calculated or received the value X1, it shall retain these in memory until it has received and processed the second KUDOS message.<a href="#section-4.3.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ssec-context-handling">
<section id="section-4.3.2">
          <h4 id="name-handling-of-oscore-security">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-handling-of-oscore-security" class="section-name selfRef">Handling of OSCORE Security Contexts</a>
          </h4>
<p id="section-4.3.2-1">The peer starting a KUDOS execution is denoted as initiator, while the other peer in the same session is denoted as responder.<a href="#section-4.3.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.2-2">The initiator completes the key update process when receiving the second KUDOS message and successfully verifying it with CTX_NEW. The responder completes the key update process when sending the second KUDOS message, as protected with CTX_NEW.<a href="#section-4.3.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.3.2-3">KUDOS may run with the initiator acting either as CoAP client or CoAP server. The former case is denoted as the "forward message flow" (see <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>) and the latter as the "reverse message flow" (see <a href="#ssec-derive-ctx-server-init" class="auto internal xref">Section 4.3.5</a>).<a href="#section-4.3.2-3" class="pilcrow">Â¶</a></p>
<p id="section-4.3.2-4">The following properties hold for both the forward and reverse message flow.<a href="#section-4.3.2-4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.2-5.1">
              <p id="section-4.3.2-5.1.1">The initiator always offers the fresh value N1.<a href="#section-4.3.2-5.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-5.2">
              <p id="section-4.3.2-5.2.1">The responder always offers the fresh value N2<a href="#section-4.3.2-5.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-5.3">
              <p id="section-4.3.2-5.3.1">The responder is always the first one deriving CTX_NEW.<a href="#section-4.3.2-5.3.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-5.4">
              <p id="section-4.3.2-5.4.1">The initiator is always the first one achieving key confirmation, hence the first one able to safely discard CTX_OLD.<a href="#section-4.3.2-5.4.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-5.5">
              <p id="section-4.3.2-5.5.1">Both the initiator and the responder use and preserve the same respective OSCORE Sender ID and Recipient ID.<a href="#section-4.3.2-5.5.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-5.6">
              <p id="section-4.3.2-5.6.1">If CTX_OLD specifies an OSCORE ID Context, both peers use and preserve the same OSCORE ID Context.<a href="#section-4.3.2-5.6.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.3.2-6">Once a peer has successfully derived the new OSCORE Security Context CTX_NEW, the following applies.<a href="#section-4.3.2-6" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.2-7.1">
              <p id="section-4.3.2-7.1.1">The peer <span class="bcp14">MUST</span> use CTX_NEW to protect outgoing non KUDOS messages, and <span class="bcp14">MUST NOT</span> use the originally shared OSCORE Security Context CTX_OLD for protecting outgoing messages.<a href="#section-4.3.2-7.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-7.2">
              <p id="section-4.3.2-7.2.1">The peer <span class="bcp14">MUST</span> delete any OSCORE Security Context CTX_DEL older than CTX_OLD, such that both CTX_DEL and CTX_OLD have the same ID_CONTEXT or no ID Context.<a href="#section-4.3.2-7.2.1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.2-7.2.2">
For instance, this can occur while using the forward message flow (see <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>}), when the initiator has just received the second KUDOS message, and immediately starts KUDOS again as initiator before sending a non KUDOS message, thereby not providing the responder with key confirmation and not allowing it to safely discard CTX_OLD.<a href="#section-4.3.2-7.2.2" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.2-7.3">
              <p id="section-4.3.2-7.3.1">The peer <span class="bcp14">MUST</span> terminate all the ongoing observations <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> that it has with the other peer as protected with the old Security Context CTX_OLD, unless the two peers have explicitly agreed otherwise as defined in <a href="#preserving-observe" class="auto internal xref">Section 4.6</a>.<a href="#section-4.3.2-7.3.1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.2-7.3.2">
More specifically, if either or both peers indicate the wish to cancel their observations, those will be all cancelled following a successful KUDOS execution.<a href="#section-4.3.2-7.3.2" class="pilcrow">Â¶</a></p>
<p id="section-4.3.2-7.3.3">
Note that, even though a peer had no real reason to update its OSCORE keying material, running KUDOS can be intentionally exploited as a more efficient way to terminate all the ongoing observations with the other peer, compared to sending one cancellation request per observation (see <span><a href="https://rfc-editor.org/rfc/rfc7641#section-3.6" class="relref">Section 3.6</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>).<a href="#section-4.3.2-7.3.3" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.3.2-8">Once a peer has successfully decrypted and verified an incoming message protected with CTX_NEW, that peer <span class="bcp14">MUST</span> discard the old Security Context CTX_OLD.<a href="#section-4.3.2-8" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="handling-of-messages">
<section id="section-4.3.3">
          <h4 id="name-handling-of-messages">
<a href="#section-4.3.3" class="section-number selfRef">4.3.3. </a><a href="#name-handling-of-messages" class="section-name selfRef">Handling of Messages</a>
          </h4>
<p id="section-4.3.3-1">If a KUDOS message is a CoAP request, then it can target two different types of resources at the recipient CoAP server:<a href="#section-4.3.3-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.3-2.1">
              <p id="section-4.3.3-2.1.1">The well-known KUDOS resource at /.well-known/kudos, or an alternative KUDOS resource with resource type "core.kudos" (see <a href="#well-known-kudos-desc" class="auto internal xref">Section 4.8.3</a> and <a href="#rt-kudos" class="auto internal xref">Section 6.5</a>). In such a case, no application processing is expected at the CoAP server, and the plain CoAP request composed before OSCORE protection should not include an application payload.<a href="#section-4.3.3-2.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-2.2">
              <p id="section-4.3.3-2.2.1">A non-KUDOS resource, i.e., an actual application resource that a CoAP request can target in order to trigger application processing at the CoAP server. In such a case, the plain CoAP request composed before OSCORE protection may include an application payload, if admitted by the request method.<a href="#section-4.3.3-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.3.3-3">Similarly, any CoAP response can also be a KUDOS message. If the corresponding CoAP request has targeted a KUDOS resource, then the plain CoAP response composed before OSCORE encryption should not include an application payload. Otherwise, an application payload may be included.<a href="#section-4.3.3-3" class="pilcrow">Â¶</a></p>
<p id="section-4.3.3-4">Once a peer acting as initiator (responder) has sent (received) the first KUDOS message, that peer <span class="bcp14">MUST NOT</span> send a non KUDOS message to the other peer, until having aborted or successfully completed the key update process on its side.<a href="#section-4.3.3-4" class="pilcrow">Â¶</a></p>
<p id="section-4.3.3-5">In order to prevent two peers from unwittingly running two simultaneous executions of KUDOS, the following applies.<a href="#section-4.3.3-5" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.3-6.1">
              <p id="section-4.3.3-6.1.1">When a peer P1 receives the first KUDOS message from a peer P2 in a KUDOS execution E1, the peer P1 <span class="bcp14">MUST</span> check whether it has a non completed KUDOS session E2 where P1 acts as initiator with P2.<a href="#section-4.3.3-6.1.1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.3-6.1.2">
To this end, P1 may check whether it is currently acting as initiator in a KUDOS execution E2 different from E1, such that both sessions aim at updating the OSCORE Security Context CTX_OLD shared with P2. The particular way to achieve this is implementation specific.<a href="#section-4.3.3-6.1.2" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.3-6.2">
              <p id="section-4.3.3-6.2.1">If P1 finds such a session E2, then P1 <span class="bcp14">MUST</span> terminate the KUDOS execution E1, and <span class="bcp14">MUST</span> reply to the first KUDOS message received from P2 with a CoAP Reset message.<a href="#section-4.3.3-6.2.1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.3-6.2.2">
Upon receiving the Reset message above, P2 terminates the KUDOS execution E2 where it acts as initiator.<a href="#section-4.3.3-6.2.2" class="pilcrow">Â¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="ssec-derive-ctx-client-init">
<section id="section-4.3.4">
          <h4 id="name-forward-message-flow">
<a href="#section-4.3.4" class="section-number selfRef">4.3.4. </a><a href="#name-forward-message-flow" class="section-name selfRef">Forward Message Flow</a>
          </h4>
<p id="section-4.3.4-1"><a href="#fig-message-exchange-client-init" class="auto internal xref">Figure 3</a> shows an example of KUDOS run in the forward message flow, i.e., with the client acting as KUDOS initiator.<a href="#section-4.3.4-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-2">In the example, 'Comb(a,b)' denotes the byte concatenation of two CBOR byte strings, where the first one has value 'a' and the second one has value 'b'. That is, Comb(a,b) = bstr .cbor a | bstr .cbor b, where | denotes byte concatenation.<a href="#section-4.3.4-2" class="pilcrow">Â¶</a></p>
<span id="name-example-of-the-kudos-forwar"></span><div id="fig-message-exchange-client-init">
<figure id="figure-3">
            <div id="section-4.3.4-3.1">
              <div class="alignCenter art-svg artwork" id="section-4.3.4-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1152" width="576" viewBox="0 0 576 1152" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 200,64 L 200,736" fill="none" stroke="black"></path>
                  <path d="M 200,816 L 200,1136" fill="none" stroke="black"></path>
                  <path d="M 384,64 L 384,736" fill="none" stroke="black"></path>
                  <path d="M 384,816 L 384,1136" fill="none" stroke="black"></path>
                  <path d="M 200,208 L 376,208" fill="none" stroke="black"></path>
                  <path d="M 208,528 L 384,528" fill="none" stroke="black"></path>
                  <path d="M 200,848 L 376,848" fill="none" stroke="black"></path>
                  <path d="M 208,1008 L 384,1008" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="384,848 372,842.4 372,853.6" fill="black" transform="rotate(0,376,848)"></polygon>
                  <polygon class="arrowhead" points="384,208 372,202.4 372,213.6" fill="black" transform="rotate(0,376,208)"></polygon>
                  <polygon class="arrowhead" points="216,1008 204,1002.4 204,1013.6" fill="black" transform="rotate(180,208,1008)"></polygon>
                  <polygon class="arrowhead" points="216,528 204,522.4 204,533.6" fill="black" transform="rotate(180,208,528)"></polygon>
                  <g class="text">
                    <text x="196" y="36">Client</text>
                    <text x="388" y="36">Server</text>
                    <text x="200" y="52">(initiator)</text>
                    <text x="384" y="52">(responder)</text>
                    <text x="36" y="84">Generate</text>
                    <text x="84" y="84">N1</text>
                    <text x="24" y="116">CTX_1</text>
                    <text x="56" y="116">=</text>
                    <text x="108" y="116">updateCtx(</text>
                    <text x="80" y="132">X1,</text>
                    <text x="80" y="148">N1,</text>
                    <text x="96" y="164">CTX_OLD</text>
                    <text x="136" y="164">)</text>
                    <text x="280" y="196">Request</text>
                    <text x="324" y="196">#1</text>
                    <text x="32" y="212">Protect</text>
                    <text x="84" y="212">with</text>
                    <text x="128" y="212">CTX_1</text>
                    <text x="468" y="212">/.well-known/kudos</text>
                    <text x="236" y="228">OSCORE</text>
                    <text x="272" y="228">{</text>
                    <text x="232" y="244">...</text>
                    <text x="248" y="260">Partial</text>
                    <text x="296" y="260">IV:</text>
                    <text x="320" y="260">0</text>
                    <text x="232" y="276">...</text>
                    <text x="224" y="292">d</text>
                    <text x="256" y="292">flag:</text>
                    <text x="288" y="292">1</text>
                    <text x="416" y="292">CTX_1</text>
                    <text x="448" y="292">=</text>
                    <text x="500" y="292">updateCtx(</text>
                    <text x="228" y="308">x:</text>
                    <text x="252" y="308">X1</text>
                    <text x="472" y="308">X1,</text>
                    <text x="244" y="324">nonce:</text>
                    <text x="284" y="324">N1</text>
                    <text x="472" y="324">N1,</text>
                    <text x="232" y="340">...</text>
                    <text x="488" y="340">CTX_OLD</text>
                    <text x="528" y="340">)</text>
                    <text x="216" y="356">}</text>
                    <text x="248" y="372">Encrypted</text>
                    <text x="320" y="372">Payload</text>
                    <text x="360" y="372">{</text>
                    <text x="420" y="372">Verify</text>
                    <text x="468" y="372">with</text>
                    <text x="512" y="372">CTX_1</text>
                    <text x="232" y="388">...</text>
                    <text x="216" y="404">}</text>
                    <text x="428" y="404">Generate</text>
                    <text x="476" y="404">N2</text>
                    <text x="424" y="436">CTX_NEW</text>
                    <text x="464" y="436">=</text>
                    <text x="516" y="436">updateCtx(</text>
                    <text x="524" y="452">Comb(X1,X2),</text>
                    <text x="524" y="468">Comb(N1,N2),</text>
                    <text x="504" y="484">CTX_OLD</text>
                    <text x="544" y="484">)</text>
                    <text x="284" y="516">Response</text>
                    <text x="332" y="516">#1</text>
                    <text x="424" y="532">Protect</text>
                    <text x="476" y="532">with</text>
                    <text x="528" y="532">CTX_NEW</text>
                    <text x="236" y="548">OSCORE</text>
                    <text x="272" y="548">{</text>
                    <text x="232" y="564">...</text>
                    <text x="32" y="580">CTX_NEW</text>
                    <text x="72" y="580">=</text>
                    <text x="124" y="580">updateCtx(</text>
                    <text x="248" y="580">Partial</text>
                    <text x="296" y="580">IV:</text>
                    <text x="320" y="580">0</text>
                    <text x="132" y="596">Comb(X1,X2),</text>
                    <text x="232" y="596">...</text>
                    <text x="132" y="612">Comb(N1,N2),</text>
                    <text x="224" y="612">d</text>
                    <text x="256" y="612">flag:</text>
                    <text x="288" y="612">1</text>
                    <text x="112" y="628">CTX_OLD</text>
                    <text x="152" y="628">)</text>
                    <text x="228" y="628">x:</text>
                    <text x="252" y="628">X2</text>
                    <text x="244" y="644">nonce:</text>
                    <text x="284" y="644">N2</text>
                    <text x="28" y="660">Verify</text>
                    <text x="76" y="660">with</text>
                    <text x="128" y="660">CTX_NEW</text>
                    <text x="232" y="660">...</text>
                    <text x="216" y="676">}</text>
                    <text x="32" y="692">Discard</text>
                    <text x="96" y="692">CTX_OLD</text>
                    <text x="248" y="692">Encrypted</text>
                    <text x="320" y="692">Payload</text>
                    <text x="360" y="692">{</text>
                    <text x="232" y="708">...</text>
                    <text x="216" y="724">}</text>
                    <text x="16" y="772">The</text>
                    <text x="60" y="772">actual</text>
                    <text x="104" y="772">key</text>
                    <text x="148" y="772">update</text>
                    <text x="208" y="772">process</text>
                    <text x="260" y="772">ends</text>
                    <text x="304" y="772">here.</text>
                    <text x="16" y="788">The</text>
                    <text x="48" y="788">two</text>
                    <text x="88" y="788">peers</text>
                    <text x="128" y="788">can</text>
                    <text x="160" y="788">use</text>
                    <text x="192" y="788">the</text>
                    <text x="224" y="788">new</text>
                    <text x="276" y="788">Security</text>
                    <text x="344" y="788">Context</text>
                    <text x="412" y="788">CTX_NEW.</text>
                    <text x="280" y="836">Request</text>
                    <text x="324" y="836">#2</text>
                    <text x="32" y="852">Protect</text>
                    <text x="84" y="852">with</text>
                    <text x="136" y="852">CTX_NEW</text>
                    <text x="416" y="852">/temp</text>
                    <text x="236" y="868">OSCORE</text>
                    <text x="272" y="868">{</text>
                    <text x="232" y="884">...</text>
                    <text x="216" y="900">}</text>
                    <text x="420" y="900">Verify</text>
                    <text x="468" y="900">with</text>
                    <text x="520" y="900">CTX_NEW</text>
                    <text x="248" y="916">Encrypted</text>
                    <text x="320" y="916">Payload</text>
                    <text x="360" y="916">{</text>
                    <text x="232" y="932">...</text>
                    <text x="424" y="932">Discard</text>
                    <text x="488" y="932">CTX_OLD</text>
                    <text x="264" y="948">Application</text>
                    <text x="344" y="948">Payload</text>
                    <text x="216" y="964">}</text>
                    <text x="284" y="996">Response</text>
                    <text x="332" y="996">#2</text>
                    <text x="424" y="1012">Protect</text>
                    <text x="476" y="1012">with</text>
                    <text x="528" y="1012">CTX_NEW</text>
                    <text x="236" y="1028">OSCORE</text>
                    <text x="272" y="1028">{</text>
                    <text x="232" y="1044">...</text>
                    <text x="28" y="1060">Verify</text>
                    <text x="76" y="1060">with</text>
                    <text x="128" y="1060">CTX_NEW</text>
                    <text x="216" y="1060">}</text>
                    <text x="248" y="1076">Encrypted</text>
                    <text x="320" y="1076">Payload</text>
                    <text x="360" y="1076">{</text>
                    <text x="232" y="1092">...</text>
                    <text x="264" y="1108">Application</text>
                    <text x="344" y="1108">Payload</text>
                    <text x="216" y="1124">}</text>
                  </g>
                </svg><a href="#section-4.3.4-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-the-kudos-forwar" class="selfRef">Example of the KUDOS forward message flow.</a>
            </figcaption></figure>
</div>
<p id="section-4.3.4-4">First, the client generates a value N1, and uses the nonce N = N1 and X = X1 together with the old Security Context CTX_OLD, in order to derive a temporary Security Context CTX_1.<a href="#section-4.3.4-4" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-5">Then, the client prepares a CoAP request targeting the well-known KUDOS resource (see <a href="#well-known-kudos-desc" class="auto internal xref">Section 4.8.3</a>) at "/.well-known/kudos". The client protects this CoAP request using CTX_1 and sends it to the server. When the client protects this request using OSCORE, it <span class="bcp14">MUST</span> use 0 as the value of Partial IV. In particular, the request has the 'd' flag bit set to 1, and specifies X1 as 'x' and N1 as 'nonce' (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>). After that, the client deletes CTX_1.<a href="#section-4.3.4-5" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-6">Upon receiving the OSCORE request, the server retrieves the value N1 from the 'nonce' field of the OSCORE Option, the value X1 from the 'x' byte of the OSCORE Option, and provides the updateCtx() function with the input N = N1, X = X1, and CTX_OLD, in order to derive the temporary Security Context CTX_1.<a href="#section-4.3.4-6" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-7"><a href="#fig-kudos-x-n-example-mess-one" class="auto internal xref">Figure 4</a> shows an example of how the two peers compute X and N provided as input to the updateCtx() function, and how they compute X_N within the updateCtx() function, when deriving CTX_1 (see <a href="#ssec-update-function" class="auto internal xref">Section 4.2</a>).<a href="#section-4.3.4-7" class="pilcrow">Â¶</a></p>
<span id="name-example-of-x-n-and-x_n-when"></span><div id="fig-kudos-x-n-example-mess-one">
<figure id="figure-4">
            <div class="alignLeft art-text artwork" id="section-4.3.4-8.1">
<pre>
   X1 and N1 expressed as raw values
   X1 = 0x07
   N1 = 0x018a278f7faab55a

   updateCtx() is called with
   X = 0x07
   N = 0x018a278f7faab55a

   In updateCtx(), X_cbor and N_cbor are built as CBOR byte strings
   X_cbor = 0x4107               (h'07')
   N_cbor = 0x48018a278f7faab55a (h'018a278f7faab55a')

   In updateCtx(), X_N is the byte concatenation of X_cbor and N_cbor
   X_N = 0x410748018a278f7faab55a
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-x-n-and-x_n-when" class="selfRef">Example of X, N, and X\_N when processing the first KUDOS message</a>
            </figcaption></figure>
</div>
<p id="section-4.3.4-9">Then, the server verifies the request by using the Security Context CTX_1.<a href="#section-4.3.4-9" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-10">After that, the server generates a value N2, and uses N = Comb(N1, N2) and X = Comb(X1, X2) together with CTX_OLD, in order to derive the new Security Context CTX_NEW.<a href="#section-4.3.4-10" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-11">An example of this nonce processing on the server with values for N1, X1, N2, and X2 is presented in <a href="#fig-kudos-x-n-example-mess-two" class="auto internal xref">Figure 5</a>.<a href="#section-4.3.4-11" class="pilcrow">Â¶</a></p>
<span id="name-example-of-x-n-and-x_n-when-"></span><div id="fig-kudos-x-n-example-mess-two">
<figure id="figure-5">
            <div class="alignLeft art-text artwork" id="section-4.3.4-12.1">
<pre>
   X1, X2, N1, and N2 expressed as raw values
   X1 = 0x07
   X2 = 0x07
   N1 = 0x018a278f7faab55a
   N2 = 0x25a8991cd700ac01

   X1, X2, N1, and N2 as CBOR byte strings
   X1 = 0x4107 (h'07')
   X2 = 0x4107 (h'07')
   N1 = 0x48018a278f7faab55a (h'018a278f7faab55a')
   N2 = 0x4825a8991cd700ac01 (h'25a8991cd700ac01')

   updateCtx() is called with
   X = 0x41074107
   N = 0x48018a278f7faab55a4825a8991cd700ac01

   In updateCtx(), X_cbor and N_cbor are built as CBOR byte strings
   X_cbor = 0x4441074107 (h'41074107')
   N_cbor = 0x5248018a278f7faab55a4825a8991cd700ac01
            (h'48018a278f7faab55a4825a8991cd700ac01')

   In updateCtx(), X_N is the byte concatenation of X_cbor and N_cbor
   X_N = 0x44410741075248018a278f7faab55a4825a8991cd700ac01
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-of-x-n-and-x_n-when-" class="selfRef">Example of X, N, and X\_N when processing the second KUDOS message</a>
            </figcaption></figure>
</div>
<p id="section-4.3.4-13">Then, the server sends an OSCORE response to the client, protected with CTX_NEW. In particular, the response has the 'd' flag bit set to 1 and specifies N2 as 'nonce'. Consistently with <a href="#sec-updated-response-protection" class="auto internal xref">Section 3</a>, the server includes its Sender Sequence Number as Partial IV in the response. After that, the server deletes CTX_1.<a href="#section-4.3.4-13" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-14">Upon receiving the OSCORE response, the client retrieves the value N2 from the 'nonce' field of the OSCORE Option, and the value X2 from the 'x' byte of the OSCORE Option. Since the client has received a response to an OSCORE request that it made with the 'd' flag bit set to 1, the client provides the updateCtx() function with the input N = Comb(N1, N2), X = Comb(X1, X2), and CTX_OLD, in order to derive CTX_NEW. Finally, the client verifies the response by using CTX_NEW and deletes CTX_OLD.<a href="#section-4.3.4-14" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-15">From then on, the two peers can protect their message exchanges by using CTX_NEW. As soon as the server successfully verifies an incoming message protected with CTX_NEW, the server deletes CTX_OLD.<a href="#section-4.3.4-15" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-16">In the example in <a href="#fig-message-exchange-client-init" class="auto internal xref">Figure 3</a>, the client takes the initiative and sends a new OSCORE request protected with CTX_NEW.<a href="#section-4.3.4-16" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-17">In case the server does not successfully verify the request, the same error handling specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.2" class="relref">Section 8.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> applies. This does not result in deleting CTX_NEW. If the server successfully verifies the request using CTX_NEW, the server deletes CTX_OLD and can reply with an OSCORE response protected with CTX_NEW.<a href="#section-4.3.4-17" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-18">Note that the server achieves key confirmation only when receiving and successfully verifying a message from the client as protected with CTX_NEW. If the server sends a non KUDOS request to the client protected with CTX_NEW before then, and the server receives a 4.01 (Unauthorized) error response as reply, the server <span class="bcp14">SHOULD</span> delete CTX_NEW and start a new KUDOS execution acting as CoAP client, i.e., as initiator in the forward message flow.<a href="#section-4.3.4-18" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-19">Also note that, if both peers reboot simultaneously, they will run the KUDOS forward message flow as defined in this section. That is, one of the two peers implementing a CoAP client will send KUDOS Request #1 in <a href="#fig-message-exchange-client-init" class="auto internal xref">Figure 3</a>.<a href="#section-4.3.4-19" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-20">In case the KUDOS message Request #1 in Figure 3 targets a non-KUDOS resource and the application at the server requires freshness for the received requests, then the server does not deliver the request to the application even if the request has been succesfully verified, and the following KUDOS message (i.e., Response #1 in Figure 3) <span class="bcp14">MUST</span> be a 4.01 (Unauthorized) error response.<a href="#section-4.3.4-20" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-21">Upon receiving the 4.01 (Unauthorized) error response as the second KUDOS message Response #1, the client processes it like described above. After successfully completing the KUDOS execution, the client can send to the server a non-KUDOS request protected with CTX_NEW (i.e., Request #2 in Figure 3). Presumably, this request targets the same resource targeted by the previous Request #1, as the same application request or a different one, if the application permits it.
Upon receiving, decrypting, and successfully verifying this request protected with CTX_NEW, the server asserts the request as fresh, leveraging the recent establishment of CTX_NEW.<a href="#section-4.3.4-21" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-22">In the example shown in <a href="#fig-message-exchange-client-init" class="auto internal xref">Figure 3</a> and discussed in this section, the first KUDOS message is a request and the second one is a response, like typically expected when using the forward message flow. However, KUDOS is not constrained to this request/response model and a KUDOS execution can be performed with any combination of CoAP requests and responses. Related examples using the forward message flow are provided later:<a href="#section-4.3.4-22" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.4-23.1">
              <p id="section-4.3.4-23.1.1"><a href="#ssec-derive-ctx-client-init-requests-only" class="auto internal xref">Appendix A</a> presents an example where both KUDOS messages are CoAP requests.<a href="#section-4.3.4-23.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.4-23.2">
              <p id="section-4.3.4-23.2.1"><a href="#ssec-derive-ctx-client-init-unrelated" class="auto internal xref">Appendix B</a> presents an example where KUDOS Response #1 is a response to a different request from KUDOS Request #1.<a href="#section-4.3.4-23.2.1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4-23.2.2">
In such a case, if the client knows that KUDOS Response #2 is going to be sent as a response to a different request from KUDOS Request #1, then the client can use the No-Response CoAP Option <span>[<a href="#RFC7967" class="cite xref">RFC7967</a>]</span> in KUDOS Request #1 without impairing the successful completion of KUDOS.<a href="#section-4.3.4-23.2.2" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.3.4-23.3">
              <p id="section-4.3.4-23.3.1"><a href="#ssec-derive-ctx-client-init-normal-resource" class="auto internal xref">Appendix C</a> presents an example where KUDOS Request #1 is sent to a non-KUDOS resource.<a href="#section-4.3.4-23.3.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<div id="avoiding-in-transit-requests-during-a-key-update">
<section id="section-4.3.4.1">
            <h5 id="name-avoiding-in-transit-request">
<a href="#section-4.3.4.1" class="section-number selfRef">4.3.4.1. </a><a href="#name-avoiding-in-transit-request" class="section-name selfRef">Avoiding In-Transit Requests During a Key Update</a>
            </h5>
<p id="section-4.3.4.1-1">Before sending the KUDOS message Request #1 in <a href="#fig-message-exchange-client-init" class="auto internal xref">Figure 3</a>, the client <span class="bcp14">MUST</span> ensure that it has no outstanding interactions with the server (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-4.7" class="relref">Section 4.7</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>), with the exception of ongoing observations <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> with that server.<a href="#section-4.3.4.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4.1-2">If there are any, the client <span class="bcp14">MUST NOT</span> initiate the KUDOS execution, before either: i) having all those outstanding interactions cleared; or ii) freeing up the Token values used with those outstanding interactions, with the exception of ongoing observations with the server.<a href="#section-4.3.4.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4.1-3">Later on, this prevents a non KUDOS response protected with CTX_NEW from cryptographically matching with both the corresponding request also protected with CTX_NEW and with an older request protected with CTX_OLD, in case the two requests were protected using the same OSCORE Partial IV.<a href="#section-4.3.4.1-3" class="pilcrow">Â¶</a></p>
<p id="section-4.3.4.1-4">During an ongoing KUDOS execution the client <span class="bcp14">MUST NOT</span> send any non-KUDOS requests to the server, even when NSTART is greater than 1 (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-4.7" class="relref">Section 4.7</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>).<a href="#section-4.3.4.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-derive-ctx-server-init">
<section id="section-4.3.5">
          <h4 id="name-reverse-message-flow">
<a href="#section-4.3.5" class="section-number selfRef">4.3.5. </a><a href="#name-reverse-message-flow" class="section-name selfRef">Reverse Message Flow</a>
          </h4>
<p id="section-4.3.5-1"><a href="#fig-message-exchange-server-init" class="auto internal xref">Figure 6</a> shows an example of KUDOS run in the reverse message flow, i.e., with the server acting as initiator.<a href="#section-4.3.5-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-2">The example uses the same notation 'Comb(a,b)' used in <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>.<a href="#section-4.3.5-2" class="pilcrow">Â¶</a></p>
<span id="name-example-of-the-kudos-revers"></span><div id="fig-message-exchange-server-init">
<figure id="figure-6">
            <div id="section-4.3.5-3.1">
              <div class="alignCenter art-svg artwork" id="section-4.3.5-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1072" width="576" viewBox="0 0 576 1072" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 200,64 L 200,816" fill="none" stroke="black"></path>
                  <path d="M 200,896 L 200,1056" fill="none" stroke="black"></path>
                  <path d="M 384,64 L 384,816" fill="none" stroke="black"></path>
                  <path d="M 384,896 L 384,1056" fill="none" stroke="black"></path>
                  <path d="M 200,96 L 376,96" fill="none" stroke="black"></path>
                  <path d="M 208,304 L 384,304" fill="none" stroke="black"></path>
                  <path d="M 200,592 L 376,592" fill="none" stroke="black"></path>
                  <path d="M 208,928 L 384,928" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="384,592 372,586.4 372,597.6" fill="black" transform="rotate(0,376,592)"></polygon>
                  <polygon class="arrowhead" points="384,96 372,90.4 372,101.6" fill="black" transform="rotate(0,376,96)"></polygon>
                  <polygon class="arrowhead" points="216,928 204,922.4 204,933.6" fill="black" transform="rotate(180,208,928)"></polygon>
                  <polygon class="arrowhead" points="216,304 204,298.4 204,309.6" fill="black" transform="rotate(180,208,304)"></polygon>
                  <g class="text">
                    <text x="204" y="36">Client</text>
                    <text x="388" y="36">Server</text>
                    <text x="200" y="52">(responder)</text>
                    <text x="384" y="52">(initiator)</text>
                    <text x="280" y="84">Request</text>
                    <text x="324" y="84">#1</text>
                    <text x="32" y="100">Protect</text>
                    <text x="84" y="100">with</text>
                    <text x="136" y="100">CTX_OLD</text>
                    <text x="416" y="100">/temp</text>
                    <text x="236" y="116">OSCORE</text>
                    <text x="272" y="116">{</text>
                    <text x="232" y="132">...</text>
                    <text x="216" y="148">}</text>
                    <text x="420" y="148">Verify</text>
                    <text x="468" y="148">with</text>
                    <text x="520" y="148">CTX_OLD</text>
                    <text x="248" y="164">Encrypted</text>
                    <text x="320" y="164">Payload</text>
                    <text x="360" y="164">{</text>
                    <text x="232" y="180">...</text>
                    <text x="428" y="180">Generate</text>
                    <text x="476" y="180">N1</text>
                    <text x="264" y="196">Application</text>
                    <text x="344" y="196">Payload</text>
                    <text x="216" y="212">}</text>
                    <text x="416" y="212">CTX_1</text>
                    <text x="448" y="212">=</text>
                    <text x="500" y="212">updateCtx(</text>
                    <text x="472" y="228">X1,</text>
                    <text x="472" y="244">N1,</text>
                    <text x="488" y="260">CTX_OLD</text>
                    <text x="528" y="260">)</text>
                    <text x="284" y="292">Response</text>
                    <text x="332" y="292">#1</text>
                    <text x="424" y="308">Protect</text>
                    <text x="476" y="308">with</text>
                    <text x="520" y="308">CTX_1</text>
                    <text x="236" y="324">OSCORE</text>
                    <text x="272" y="324">{</text>
                    <text x="232" y="340">...</text>
                    <text x="24" y="356">CTX_1</text>
                    <text x="56" y="356">=</text>
                    <text x="108" y="356">updateCtx(</text>
                    <text x="248" y="356">Partial</text>
                    <text x="296" y="356">IV:</text>
                    <text x="320" y="356">0</text>
                    <text x="80" y="372">X1,</text>
                    <text x="232" y="372">...</text>
                    <text x="80" y="388">N1,</text>
                    <text x="224" y="388">d</text>
                    <text x="256" y="388">flag:</text>
                    <text x="288" y="388">1</text>
                    <text x="96" y="404">CTX_OLD</text>
                    <text x="136" y="404">)</text>
                    <text x="228" y="404">x:</text>
                    <text x="252" y="404">X1</text>
                    <text x="244" y="420">nonce:</text>
                    <text x="284" y="420">N1</text>
                    <text x="28" y="436">Verify</text>
                    <text x="76" y="436">with</text>
                    <text x="120" y="436">CTX_1</text>
                    <text x="232" y="436">...</text>
                    <text x="216" y="452">}</text>
                    <text x="36" y="468">Generate</text>
                    <text x="84" y="468">N2</text>
                    <text x="248" y="468">Encrypted</text>
                    <text x="320" y="468">Payload</text>
                    <text x="360" y="468">{</text>
                    <text x="232" y="484">...</text>
                    <text x="32" y="500">CTX_NEW</text>
                    <text x="72" y="500">=</text>
                    <text x="124" y="500">updateCtx(</text>
                    <text x="216" y="500">}</text>
                    <text x="132" y="516">Comb(X1,X2),</text>
                    <text x="132" y="532">Comb(N1,N2),</text>
                    <text x="112" y="548">CTX_OLD</text>
                    <text x="152" y="548">)</text>
                    <text x="280" y="580">Request</text>
                    <text x="324" y="580">#2</text>
                    <text x="32" y="596">Protect</text>
                    <text x="84" y="596">with</text>
                    <text x="136" y="596">CTX_NEW</text>
                    <text x="468" y="596">/.well-known/kudos</text>
                    <text x="236" y="612">OSCORE</text>
                    <text x="272" y="612">{</text>
                    <text x="232" y="628">...</text>
                    <text x="224" y="644">d</text>
                    <text x="256" y="644">flag:</text>
                    <text x="288" y="644">1</text>
                    <text x="424" y="644">CTX_NEW</text>
                    <text x="464" y="644">=</text>
                    <text x="516" y="644">updateCtx(</text>
                    <text x="228" y="660">x:</text>
                    <text x="252" y="660">X2</text>
                    <text x="524" y="660">Comb(X1,X2),</text>
                    <text x="244" y="676">nonce:</text>
                    <text x="284" y="676">N2</text>
                    <text x="524" y="676">Comb(N1,N2),</text>
                    <text x="228" y="692">y:</text>
                    <text x="248" y="692">w</text>
                    <text x="504" y="692">CTX_OLD</text>
                    <text x="544" y="692">)</text>
                    <text x="260" y="708">old_nonce:</text>
                    <text x="316" y="708">N1</text>
                    <text x="232" y="724">...</text>
                    <text x="216" y="740">}</text>
                    <text x="248" y="756">Encrypted</text>
                    <text x="320" y="756">Payload</text>
                    <text x="360" y="756">{</text>
                    <text x="420" y="756">Verify</text>
                    <text x="468" y="756">with</text>
                    <text x="520" y="756">CTX_NEW</text>
                    <text x="232" y="772">...</text>
                    <text x="264" y="788">Application</text>
                    <text x="344" y="788">Payload</text>
                    <text x="216" y="804">}</text>
                    <text x="424" y="804">Discard</text>
                    <text x="488" y="804">CTX_OLD</text>
                    <text x="16" y="852">The</text>
                    <text x="60" y="852">actual</text>
                    <text x="104" y="852">key</text>
                    <text x="148" y="852">update</text>
                    <text x="208" y="852">process</text>
                    <text x="260" y="852">ends</text>
                    <text x="304" y="852">here.</text>
                    <text x="16" y="868">The</text>
                    <text x="48" y="868">two</text>
                    <text x="88" y="868">peers</text>
                    <text x="128" y="868">can</text>
                    <text x="160" y="868">use</text>
                    <text x="192" y="868">the</text>
                    <text x="224" y="868">new</text>
                    <text x="276" y="868">Security</text>
                    <text x="344" y="868">Context</text>
                    <text x="412" y="868">CTX_NEW.</text>
                    <text x="284" y="916">Response</text>
                    <text x="332" y="916">#2</text>
                    <text x="424" y="932">Protect</text>
                    <text x="476" y="932">with</text>
                    <text x="528" y="932">CTX_NEW</text>
                    <text x="236" y="948">OSCORE</text>
                    <text x="272" y="948">{</text>
                    <text x="232" y="964">...</text>
                    <text x="28" y="980">Verify</text>
                    <text x="76" y="980">with</text>
                    <text x="128" y="980">CTX_NEW</text>
                    <text x="216" y="980">}</text>
                    <text x="248" y="996">Encrypted</text>
                    <text x="320" y="996">Payload</text>
                    <text x="360" y="996">{</text>
                    <text x="32" y="1012">Discard</text>
                    <text x="96" y="1012">CTX_OLD</text>
                    <text x="232" y="1012">...</text>
                    <text x="264" y="1028">Application</text>
                    <text x="344" y="1028">Payload</text>
                    <text x="216" y="1044">}</text>
                  </g>
                </svg><a href="#section-4.3.5-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-example-of-the-kudos-revers" class="selfRef">Example of the KUDOS reverse message flow</a>
            </figcaption></figure>
</div>
<p id="section-4.3.5-4">First, the client sends a normal OSCORE request to the server, protected with the old Security Context CTX_OLD and with the 'd' flag bit set to 0.<a href="#section-4.3.5-4" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-5">Upon receiving the OSCORE request and after having verified it with CTX_OLD as usual, the server generates a value N1 and provides the updateCtx() function with the input N = N1, X = X1, and CTX_OLD, in order to derive the temporary Security Context CTX_1.<a href="#section-4.3.5-5" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-6">Then, the server sends an OSCORE response to the client, protected with CTX_1. In particular, the response has the 'd' flag bit set to 1 and specifies N1 as 'nonce' (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>). After that, the server deletes CTX_1. Consistently with <a href="#sec-updated-response-protection" class="auto internal xref">Section 3</a>, the server includes its Sender Sequence Number as Partial IV in the response. After that, the server deletes CTX_1.<a href="#section-4.3.5-6" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-7">Upon receiving the OSCORE response, the client retrieves the value N1 from the 'nonce' field of the OSCORE Option and the value X1 from the 'x' byte of the OSCORE Option. Then, the client provides the updateCtx() function with the input N = N1, X = X1, and CTX_OLD, in order to derive the temporary Security Context CTX_1.<a href="#section-4.3.5-7" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-8">Then, the client verifies the response by using the Security Context CTX_1.<a href="#section-4.3.5-8" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-9">After that, the client generates a value N2, and provides the updateCtx() function with the input N = Comb(N1, N2), X = Comb(X1, X2), and CTX_OLD, in order to derive the new Security Context CTX_NEW. Then, the client sends an OSCORE request to the server, protected with CTX_NEW. In particular, the request has the 'd' flag bit set to 1 and specifies N2 as 'nonce' and N1 as 'old_nonce'. After that, the client deletes CTX_1.<a href="#section-4.3.5-9" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-10">Upon receiving the OSCORE request, the server retrieves the values N1 from the 'old_nonce' field of the OSCORE Option, the value N2 from the 'nonce' field of the OSCORE Option, and the value X2 from the 'x' byte of the OSCORE Option. Then, the server verifies that: i) the value N1 is identical to the value N1 specified in a previous OSCORE response with the 'd' flag bit set to 1; and ii) the value N1 | N2 has not been received before in an OSCORE request with the 'd' flag bit set to 1.<a href="#section-4.3.5-10" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-11">If the verification succeeds, the server provides the updateCtx() function with the input N = Comb(N1, N2), X = Comb(X1, X2), and CTX_OLD, in order to derive the new Security Context CTX_NEW. Finally, the server verifies the request by using CTX_NEW and deletes CTX_OLD.<a href="#section-4.3.5-11" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-12">From then on, the two peers can protect their message exchanges by using CTX_NEW. In particular, as shown in the example in <a href="#fig-message-exchange-server-init" class="auto internal xref">Figure 6</a>, the server can send an OSCORE response protected with CTX_NEW.<a href="#section-4.3.5-12" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-13">In case the client does not successfully verify the response, the same error handling specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8.4" class="relref">Section 8.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> applies. This does not result in deleting CTX_NEW. If the client successfully verifies the response using CTX_NEW, the client deletes CTX_OLD. Note that, if the verification of the response fails, the client may want to send again the normal OSCORE request to the server it initially sent (to /temp in the example above), in order to ensure the retrieval of the resource representation.<a href="#section-4.3.5-13" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-14">More generally, as soon as the client successfully verifies an incoming message protected with CTX_NEW, the client deletes CTX_OLD.<a href="#section-4.3.5-14" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-15">Note that the client achieves key confirmation only when receiving and successfully verifying a message from the server as protected with CTX_NEW. If the client sends a non KUDOS request to the server protected with CTX_NEW before then, and the client receives a 4.01 (Unauthorized) error response as reply, the client <span class="bcp14">SHOULD</span> delete CTX_NEW and start a new KUDOS execution acting again as CoAP client, i.e., as initiator in the forward message flow (see <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>).<a href="#section-4.3.5-15" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5-16">It might be the case that the server is only a CoAP server (i.e., it does not implement a CoAP client) and, at the same time, it becomes unable to safely decrypt further incoming messages from the client. For example, this occurs when the server reaches key usage limits for its Recipient Key in the OSCORE Security Context shared with the client (see <span>[<a href="#I-D.ietf-core-oscore-key-limits" class="cite xref">I-D.ietf-core-oscore-key-limits</a>]</span>). When this happens, the server cannot decrypt Request #1. Consequently, the server replies to the client with an unprotected 4.01 (Unauthorized) response, and is therefore practically unable to execute KUDOS with the client in the reverse message flow. In such a case, the only chance for the server to perform a key update with the client by means of KUDOS relies on the client starting a KUDOS execution using the forward message flow (see <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>).<a href="#section-4.3.5-16" class="pilcrow">Â¶</a></p>
<div id="avoiding-in-transit-requests-during-a-key-update-1">
<section id="section-4.3.5.1">
            <h5 id="name-avoiding-in-transit-requests">
<a href="#section-4.3.5.1" class="section-number selfRef">4.3.5.1. </a><a href="#name-avoiding-in-transit-requests" class="section-name selfRef">Avoiding In-Transit Requests During a Key Update</a>
            </h5>
<p id="section-4.3.5.1-1">Before sending the KUDOS message Request #2 in <a href="#fig-message-exchange-server-init" class="auto internal xref">Figure 6</a>, the client <span class="bcp14">MUST</span> ensure that it has no outstanding interactions with the server (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-4.7" class="relref">Section 4.7</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>), with the exception of ongoing observations <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span> with that server.<a href="#section-4.3.5.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5.1-2">If there are any, the client <span class="bcp14">MUST NOT</span> initiate the KUDOS execution, before either: i) having all those outstanding interactions cleared; or ii) freeing up the Token values used with those outstanding interactions, with the exception of ongoing observations with the server.<a href="#section-4.3.5.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5.1-3">Later on, this prevents a non KUDOS response protected with the new Security Context CTX_NEW from cryptographically matching with both the corresponding request also protected with CTX_NEW and with an older request protected with CTX_OLD, in case the two requests were protected using the same OSCORE Partial IV.<a href="#section-4.3.5.1-3" class="pilcrow">Â¶</a></p>
<p id="section-4.3.5.1-4">During an ongoing KUDOS execution the client <span class="bcp14">MUST NOT</span> send any non-KUDOS requests to the server, even when NSTART is greater than 1 (see <span><a href="https://rfc-editor.org/rfc/rfc7252#section-4.7" class="relref">Section 4.7</a> of [<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>).<a href="#section-4.3.5.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="avoiding-deadlocks">
<section id="section-4.4">
        <h3 id="name-avoiding-deadlocks">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-avoiding-deadlocks" class="section-name selfRef">Avoiding Deadlocks</a>
        </h3>
<p id="section-4.4-1">This section defines how to avoid a deadlock in different scenarios.<a href="#section-4.4-1" class="pilcrow">Â¶</a></p>
<div id="scenario-1">
<section id="section-4.4.1">
          <h4 id="name-scenario-1">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-scenario-1" class="section-name selfRef">Scenario 1</a>
          </h4>
<p id="section-4.4.1-1">In this scenario, an execution of KUDOS fails at PEER_1 acting as initiator, but successfully completes at PEER_2 acting as responder. After that, PEER_1 still stores CTX_OLD, while PEER_2 stores CTX_OLD and the just derived CTX_NEW.<a href="#section-4.4.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1-2">Then, PEER_1 starts a new KUDOS execution acting again as initiator, by sending the first KUDOS message as a CoAP request. This is protected with a temporary Security Context CTX_1, which is newly derived from the retained CTX_OLD, and from the new values X1 and N1 exchanged in the present KUDOS execution.<a href="#section-4.4.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1-3">Upon receiving the first KUDOS message, PEER_2, acting again as responder, proceeds as follows.<a href="#section-4.4.1-3" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1-4">
<li id="section-4.4.1-4.1">
              <p id="section-4.4.1-4.1.1">PEER_2 attempts to verify the first KUDOS message by using a temporary Security Context CTX_1'. This is derived from the Security Context CTX_NEW established during the latest successfully completed KUDOS execution.<a href="#section-4.4.1-4.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.4.1-4.2">
              <p id="section-4.4.1-4.2.1">The message verification inevitably fails. If PEER_2 is acting as CoAP server, it <span class="bcp14">MUST NOT</span> reply with an unprotected 4.01 (Unauthorized) CoAP response yet.<a href="#section-4.4.1-4.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.4.1-4.3">
              <p id="section-4.4.1-4.3.1">PEER_2 <span class="bcp14">MUST</span> attempt to verify the first KUDOS message by using a temporary Security Context CTX_1. This is newly derived from the Security Context CTX_OLD retained after the latest successfully completed KUDOS execution, and from the values X1 and N1 exchanged in the present KUDOS execution.<a href="#section-4.4.1-4.3.1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1-4.3.2">
If the message verification fails, PEER_2: i) retains CTX_OLD and CTX_NEW from the latest successfully completed KUDOS execution; ii) if acting as CoAP server, replies with an unprotected 4.01 (Unauthorized) CoAP response.<a href="#section-4.4.1-4.3.2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.1-4.3.3">
If the message verification succeeds, PEER_2: i) retains CTX_OLD from the latest successfully completed KUDOS execution; ii) replaces CTX_NEW from the latest successfully completed KUDOS execution with a new Security Context CTX_NEW', derived from CTX_OLD and from the values X1, X2, N1, and N2 exchanged in the present KUDOS execution; iii) replies with the second KUDOS message, which is protected with the just derived CTX_NEW'.<a href="#section-4.4.1-4.3.3" class="pilcrow">Â¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="scenario-2">
<section id="section-4.4.2">
          <h4 id="name-scenario-2">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-scenario-2" class="section-name selfRef">Scenario 2</a>
          </h4>
<p id="section-4.4.2-1">In this scenario, an execution of KUDOS fails at PEER_1 acting as initiator, but successfully completes at PEER_2 acting as responder. After that, PEER_1 still stores CTX_OLD, while PEER_2 stores CTX_OLD and the just derived CTX_NEW.<a href="#section-4.4.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-2">Then, PEER_2 starts a new KUDOS execution, this time acting as initiator, by sending the first KUDOS message as a CoAP request. This is protected with a temporary Security Context CTX_1, which is newly derived from CTX_NEW established during the latest successfully completed KUDOS execution, as well as from the new values X1 and N1 exchanged in the present KUDOS execution.<a href="#section-4.4.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-3">Upon receiving the first KUDOS message, PEER_1, this time acting as responder, proceeds as follows.<a href="#section-4.4.2-3" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.2-4">
<li id="section-4.4.2-4.1">
              <p id="section-4.4.2-4.1.1">PEER_1 attempts to verify the first KUDOS message by using a temporary Security Context CTX_1', which is derived from the retained Security Context CTX_OLD and from the values X1 and N1 exchanged in the present KUDOS execution.<a href="#section-4.4.2-4.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.4.2-4.2">
              <p id="section-4.4.2-4.2.1">The message verification inevitably fails. If PEER_1 is acting as CoAP server, it replies with an unprotected 4.01 (Unauthorized) CoAP response.<a href="#section-4.4.2-4.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.4.2-4.3">
              <p id="section-4.4.2-4.3.1">If PEER_2 does not receive the second KUDOS message for a pre-defined amount of time, or if it receives a 4.01 (Unauthorized) CoAP response when acting as CoAP client, then PEER_2 can start a new KUDOS execution for a maximum, pre-defined number of times.<a href="#section-4.4.2-4.3.1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-4.3.2">
In this case, PEER_2 sends a new first KUDOS message protected with a temporary Security Context CTX_1', which is derived from the retained CTX_OLD, as well as from the new values X1 and N1 exchanged in the present KUDOS execution.<a href="#section-4.4.2-4.3.2" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-4.3.3">
During this time, PEER_2 does not delete CTX_NEW established during the latest successfully completed KUDOS execution, and does not delete CTX_OLD unless it successfully verifies an incoming message protected with CTX_NEW.<a href="#section-4.4.2-4.3.3" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.4.2-4.4">
              <p id="section-4.4.2-4.4.1">Upon receiving such a new, first KUDOS message, PEER_1 verifies it by using the temporary Security Context CTX_1', which is derived from the Security Context CTX_OLD, and from the values X1 and N1 exchanged in the present KUDOS execution.<a href="#section-4.4.2-4.4.1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-4.4.2">
If the message verification succeeds, PEER_1 derives an OSCORE Security Context CTX_NEW' from CTX_OLD and from the values X1, X2, N1, and N2 exchanged in the present KUDOS execution. Then, it replies with the second KUDOS message, which is protected with the latest, just derived CTX_NEW'.<a href="#section-4.4.2-4.4.2" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.4.2-4.5">
              <p id="section-4.4.2-4.5.1">Upon receiving such second KUDOS message, PEER_2 derives CTX_NEW' from the retained CTX_OLD and from the values X1, X2, N1, and N2 exchanged in the present KUDOS execution. Then, PEER_2 attempts to verify the KUDOS message using the just derived CTX_NEW'.<a href="#section-4.4.2-4.5.1" class="pilcrow">Â¶</a></p>
<p id="section-4.4.2-4.5.2">
If the message verification succeeds, PEER_2 deletes the retained CTX_OLD as well as the retained CTX_NEW established during the immediately previously, successfully completed KUDOS execution.<a href="#section-4.4.2-4.5.2" class="pilcrow">Â¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="scenario-3">
<section id="section-4.4.3">
          <h4 id="name-scenario-3">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-scenario-3" class="section-name selfRef">Scenario 3</a>
          </h4>
<p id="section-4.4.3-1">When KUDOS is run in the reverse message flow (see <a href="#ssec-derive-ctx-server-init" class="auto internal xref">Section 4.3.5</a>), the two peers risk to run into a deadlock, if all the following conditions hold.<a href="#section-4.4.3-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.3-2.1">
              <p id="section-4.4.3-2.1.1">The client is a client-only device, i.e., it does not act as CoAP server and thus does not listen for incoming requests.<a href="#section-4.4.3-2.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.4.3-2.2">
              <p id="section-4.4.3-2.2.1">The server needs to execute KUDOS, which, due to the previous point, can only be performed in its reverse message flow. That is, the server has to wait for an incoming non KUDOS request, in order to initiate KUDOS by replying with the first KUDOS message as a response.<a href="#section-4.4.3-2.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.4.3-2.3">
              <p id="section-4.4.3-2.3.1">The client sends only Non-confirmable CoAP requests to the server and does not expect responses sent back as reply, hence freeing up a request's Token value once the request is sent.<a href="#section-4.4.3-2.3.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.4.3-3">In such a case, in order to avoid experiencing a deadlock situation where the server needs to execute KUDOS but cannot practically initiate it, a client-only device that supports KUDOS <span class="bcp14">SHOULD</span> intersperse Non-confirmable requests it sends to that server with confirmable requests.<a href="#section-4.4.3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="no-fs-mode">
<section id="section-4.5">
        <h3 id="name-key-update-with-or-without-">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-key-update-with-or-without-" class="section-name selfRef">Key Update with or without Forward Secrecy</a>
        </h3>
<p id="section-4.5-1">The FS mode of the KUDOS procedure defined in <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a> ensures forward secrecy of the OSCORE keying material. However, it requires peers executing KUDOS to preserve their state (e.g., across a device reboot), by writing information such as data from the newly derived OSCORE Security Context CTX_NEW in non-volatile memory.<a href="#section-4.5-1" class="pilcrow">Â¶</a></p>
<p id="section-4.5-2">This can be problematic for devices that cannot dynamically write information to non-volatile memory. For example, some devices may support only a single writing in persistent memory when initial keying material is provided (e.g., at manufacturing or commissioning time), but no further writing after that. Therefore, these devices cannot perform a stateful key update procedure, and thus are not capable to run KUDOS in FS mode to achieve forward secrecy.<a href="#section-4.5-2" class="pilcrow">Â¶</a></p>
<p id="section-4.5-3">In order to address these limitations, KUDOS can be run in its stateless no-FS mode, as defined in the following. This allows two peers to achieve the same results as when running KUDOS in FS mode (see <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>), with the difference that no forward secrecy is achieved and no state information is required to be dynamically written in non-volatile memory.<a href="#section-4.5-3" class="pilcrow">Â¶</a></p>
<p id="section-4.5-4">From a practical point of view, the two modes differ as to what exact OSCORE Master Secret and Master Salt are used as part of the OSCORE Security Context CTX_OLD provided as input to the updateCtx() function (see <a href="#ssec-update-function" class="auto internal xref">Section 4.2</a>).<a href="#section-4.5-4" class="pilcrow">Â¶</a></p>
<p id="section-4.5-5">If either or both peers are not able to write in non-volatile memory the OSCORE Master Secret and OSCORE Master Salt from the newly derived Security Context CTX_NEW, then the two peers have to run KUDOS in no-FS mode.<a href="#section-4.5-5" class="pilcrow">Â¶</a></p>
<div id="key-material-handling">
<section id="section-4.5.1">
          <h4 id="name-handling-and-use-of-keying-">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-handling-and-use-of-keying-" class="section-name selfRef">Handling and Use of Keying Material</a>
          </h4>
<p id="section-4.5.1-1">In the following, a device is denoted as "CAPABLE" if it is able to store information in non-volatile memory (e.g., on disk), beyond a one-time-only writing occurring at manufacturing or (re-)commissioning time. If that is not the case, the device is denoted as "non-CAPABLE".<a href="#section-4.5.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.5.1-2">The following terms are used to refer to OSCORE keying material.<a href="#section-4.5.1-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-3.1">
              <p id="section-4.5.1-3.1.1">Bootstrap Master Secret and Bootstrap Master Salt. If pre-provisioned during manufacturing or (re-)commissioning, these OSCORE Master Secret and Master Salt are initially stored on disk and are never going to be overwritten by the device.<a href="#section-4.5.1-3.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-3.2">
              <p id="section-4.5.1-3.2.1">Latest Master Secret and Latest Master Salt. These OSCORE Master Secret and Master Salt can be dynamically updated by the device. In case of reboot, they are lost unless they have been stored on disk.<a href="#section-4.5.1-3.2.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.5.1-4">Note that:<a href="#section-4.5.1-4" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-5.1">
              <p id="section-4.5.1-5.1.1">A peer running KUDOS can have none of the pairs above associated with another peer, only one, or both.<a href="#section-4.5.1-5.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-5.2">
              <p id="section-4.5.1-5.2.1">A peer that has neither of the pairs above associated with another peer, cannot run KUDOS in any mode with that other peer.<a href="#section-4.5.1-5.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-5.3">
              <p id="section-4.5.1-5.3.1">A peer that has only one of the pairs above associated with another peer can attempt to run KUDOS with that other peer, but the procedure might fail depending on the other peer's capabilities. In particular:<a href="#section-4.5.1-5.3.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-5.3.2.1">
                  <p id="section-4.5.1-5.3.2.1.1">In order to run KUDOS in FS mode, a peer must be a CAPABLE device. It follows that two peers have to both be CAPABLE devices in order to be able to run KUDOS in FS mode with one another.<a href="#section-4.5.1-5.3.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.5.1-5.3.2.2">
                  <p id="section-4.5.1-5.3.2.2.1">In order to run KUDOS in no-FS mode, a peer must have Bootstrap Master Secret and Bootstrap Master Salt available as stored on disk.<a href="#section-4.5.1-5.3.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.1-5.4">
              <p id="section-4.5.1-5.4.1">A peer that is a non-CAPABLE device <span class="bcp14">MUST</span> support the no-FS mode.<a href="#section-4.5.1-5.4.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-5.5">
              <p id="section-4.5.1-5.5.1">A peer that is a CAPABLE device <span class="bcp14">MUST</span> support the FS mode and the no-FS mode.<a href="#section-4.5.1-5.5.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-5.6">
              <p id="section-4.5.1-5.6.1">As an exception to the nonces being generated as random values (see <a href="#ssec-nonces-x-bytes" class="auto internal xref">Section 4.3.1</a>), a peer that is a CAPABLE device <span class="bcp14">MAY</span> use a value obtained from a monotonically incremented counter as nonce N1 or N2. This has privacy implications, which are described in <a href="#sec-cons" class="auto internal xref">Section 5</a>. In such a case, the peer <span class="bcp14">MUST</span> enforce measures to ensure freshness of the nonce values. For example, the peer can use the same procedure described in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.1.1" class="relref">Appendix B.1.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> for handling the OSCORE Sender Sequence Number values. These measures require to regularly store the used counter values in non-volatile memory, which makes non-CAPABLE devices unable to safely use counter values as nonce values.<a href="#section-4.5.1-5.6.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.5.1-6">As a general rule, once successfully generated a new OSCORE Security Context CTX (e.g., CTX is the CTX_NEW resulting from a KUDOS execution, or it has been established through the EDHOC protocol <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>), a peer considers the Master Secret and Master Salt of CTX as Latest Master Secret and Latest Master Salt. After that:<a href="#section-4.5.1-6" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-7.1">
              <p id="section-4.5.1-7.1.1">If the peer is a CAPABLE device, it <span class="bcp14">MUST</span> store Latest Master Secret and Latest Master Salt on disk, with the exception of possible temporary OSCORE Security Contexts used during a key update procedure, such as CTX_1 used during the KUDOS execution. That is, the OSCORE Master Secret and Master Salt from such temporary Security Contexts are not stored on disk.<a href="#section-4.5.1-7.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-7.2">
              <p id="section-4.5.1-7.2.1">The peer <span class="bcp14">MUST</span> store Latest Master Secret and Latest Master Salt in volatile memory, thus making them available to OSCORE message processing and possible key update procedures.<a href="#section-4.5.1-7.2.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<div id="actions-after-device-reboot">
<section id="section-4.5.1.1">
            <h5 id="name-actions-after-device-reboot">
<a href="#section-4.5.1.1" class="section-number selfRef">4.5.1.1. </a><a href="#name-actions-after-device-reboot" class="section-name selfRef">Actions after Device Reboot</a>
            </h5>
<p id="section-4.5.1.1-1">Building on the above, after having experienced a reboot, a peer A checks whether it has stored on disk a pair P1 = (Latest Master Secret, Latest Master Salt) associated with any another peer B.<a href="#section-4.5.1.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1.1-2.1">
                <p id="section-4.5.1.1-2.1.1">If a pair P1 is found, the peer A performs the following actions.<a href="#section-4.5.1.1-2.1.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1.1-2.1.2.1">
                    <p id="section-4.5.1.1-2.1.2.1.1">The peer A loads the Latest Master Secret and Latest Master Salt to volatile memory, and uses them to derive an OSCORE Security Context CTX_OLD.<a href="#section-4.5.1.1-2.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                  <li class="normal" id="section-4.5.1.1-2.1.2.2">
                    <p id="section-4.5.1.1-2.1.2.2.1">The peer A runs KUDOS with the other peer B, acting as initiator. If the peer A is a CAPABLE device, it stores on disk the Master Secret and Master Salt from the newly established OSCORE Security Context CTX_NEW, as Latest Master Secret and Latest Master Salt, respectively.<a href="#section-4.5.1.1-2.1.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-4.5.1.1-2.2">
                <p id="section-4.5.1.1-2.2.1">If a pair P1 is not found, the peer A checks whether it has stored on disk a pair P2 = (Bootstrap Master Secret, Bootstrap Master Salt) associated with the other peer B.<a href="#section-4.5.1.1-2.2.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1.1-2.2.2.1">
                    <p id="section-4.5.1.1-2.2.2.1.1">If a pair P2 is found, the peer A performs the following actions.<a href="#section-4.5.1.1-2.2.2.1.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1.1-2.2.2.1.2.1">
                        <p id="section-4.5.1.1-2.2.2.1.2.1.1">The peer A loads the Bootstrap Master Secret and Bootstrap Master Salt to volatile memory, and uses them to derive an OSCORE Security Context CTX_OLD.<a href="#section-4.5.1.1-2.2.2.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
                      <li class="normal" id="section-4.5.1.1-2.2.2.1.2.2">
                        <p id="section-4.5.1.1-2.2.2.1.2.2.1">If the peer A is a CAPABLE device, it stores on disk Bootstrap Master Secret and Bootstrap Master Salt as Latest Master Secret and Latest Master Salt, respectively. This supports the situation where A is a CAPABLE device and has never run KUDOS with the other peer B before.<a href="#section-4.5.1.1-2.2.2.1.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                      <li class="normal" id="section-4.5.1.1-2.2.2.1.2.3">
                        <p id="section-4.5.1.1-2.2.2.1.2.3.1">The peer A runs KUDOS with the other peer B, acting as initiator. If the peer A is a CAPABLE device, it stores on disk the Master Secret and Master Salt from the newly established OSCORE Security Context CTX_NEW, as Latest Master Secret and Latest Master Salt, respectively.<a href="#section-4.5.1.1-2.2.2.1.2.3.1" class="pilcrow">Â¶</a></p>
</li>
                    </ul>
</li>
                  <li class="normal" id="section-4.5.1.1-2.2.2.2">
                    <p id="section-4.5.1.1-2.2.2.2.1">If a pair P2 is not found, the peer A has to use alternative ways to establish a first OSCORE Security Context CTX_NEW with the other peer B, e.g., by running the EDHOC protocol. After that, if A is a CAPABLE device, it stores on disk the OSCORE Master Secret and Master Salt from the newly established OSCORE Security Context CTX_NEW, as Latest Master Secret and Latest Master Salt, respectively.<a href="#section-4.5.1.1-2.2.2.2.1" class="pilcrow">Â¶</a></p>
</li>
                </ul>
</li>
            </ul>
<p id="section-4.5.1.1-3">Following a state loss (e.g., due to a reboot), a device <span class="bcp14">MUST</span> first complete a successful KUDOS execution (with either of the workflows) before exchanging OSCORE-protected application data with another peer. An exception is a CAPABLE device implementing a functionality for safely reusing old keying material, such as the one defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.1" class="relref">Appendix B.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-4.5.1.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="no-fs-signaling">
<section id="section-4.5.2">
          <h4 id="name-selection-of-kudos-mode">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-selection-of-kudos-mode" class="section-name selfRef">Selection of KUDOS Mode</a>
          </h4>
<p id="section-4.5.2-1">During a KUDOS execution, the two peers agree on whether to perform the key update procedure in FS mode or no-FS mode, by leveraging the "No Forward Secrecy" bit, 'p', in the 'x' byte of the OSCORE Option value of the KUDOS messages (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>). The 'p' bit practically determines what OSCORE Security Context to use as CTX_OLD during the KUDOS execution, consistently with the indicated mode.<a href="#section-4.5.2-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-2.1">
              <p id="section-4.5.2-2.1.1">If the 'p' bit is set to 0 (FS mode), the updateCtx() function used to derive CTX_1 or CTX_NEW considers as input CTX_OLD the current OSCORE Security Context shared with the other peer as is. In particular, CTX_OLD includes Latest Master Secret as OSCORE Master Secret and Latest Master Salt as OSCORE Master Salt.<a href="#section-4.5.2-2.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-2.2">
              <p id="section-4.5.2-2.2.1">If the 'p' bit is set to 1 (no-FS mode), the updateCtx() function used to derive CTX_1 or CTX_NEW considers as input CTX_OLD the current OSCORE Security Context shared with the other peer, with the following difference: Bootstrap Master Secret is used as OSCORE Master Secret and Bootstrap Master Salt is used as OSCORE Master Salt. That is, every execution of KUDOS in no-FS mode between these two peers considers the same pair (Master Secret, Master Salt) in the OSCORE Security Context CTX_OLD provided as input to the updateCtx() function, hence the impossibility to achieve forward secrecy.<a href="#section-4.5.2-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.5.2-3">A peer determines to run KUDOS either in FS or no-FS mode with another peer as follows.<a href="#section-4.5.2-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-4.1">
              <p id="section-4.5.2-4.1.1">If a peer A is a non-CAPABLE device, it <span class="bcp14">MUST</span> run KUDOS only in no-FS mode. That is, when sending a KUDOS message, it <span class="bcp14">MUST</span> set to 1 the 'p' bit of the 'x' byte in the OSCORE Option value.<a href="#section-4.5.2-4.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-4.2">
              <p id="section-4.5.2-4.2.1">If a peer A is a CAPABLE device, it <span class="bcp14">SHOULD</span> run KUDOS only in FS mode. That is, when sending a KUDOS message, it <span class="bcp14">SHOULD</span> set to 0 the 'p' bit of the 'x' byte in the OSCORE Option value. An exception applies in the following cases.<a href="#section-4.5.2-4.2.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-4.2.2.1">
                  <p id="section-4.5.2-4.2.2.1.1">The peer A is running KUDOS with another peer B, which A has learned to be a non-CAPABLE device (and hence not able to run KUDOS in FS mode).<a href="#section-4.5.2-4.2.2.1.1" class="pilcrow">Â¶</a></p>
<p id="section-4.5.2-4.2.2.1.2">
Note that, if the peer A is a CAPABLE device, it is able to store such information about the other peer B on disk and it <span class="bcp14">MUST</span> do so. From then on, the peer A will perform every execution of KUDOS with the peer B in no-FS mode, including after a possible reboot.<a href="#section-4.5.2-4.2.2.1.2" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.5.2-4.2.2.2">
                  <p id="section-4.5.2-4.2.2.2.1">The peer A is acting as responder and running KUDOS with another peer B without knowing its capabilities, and A receives a KUDOS message where the 'p' bit of the 'x' byte in the OSCORE Option value is set to 1.<a href="#section-4.5.2-4.2.2.2.1" class="pilcrow">Â¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.5.2-4.3">
              <p id="section-4.5.2-4.3.1">If a peer A is a CAPABLE device and has learned that another peer B is also a CAPABLE device (and hence able to run KUDOS in FS mode), then the peer A <span class="bcp14">MUST NOT</span> run KUDOS with the peer B in no-FS mode. This also means that, if the peer A acts as responder when running KUDOS with the peer B, the peer A <span class="bcp14">MUST</span> terminate the KUDOS execution if it receives a KUDOS message from the peer B where the 'p' bit of the 'x' byte in the OSCORE Option value is set to 1.<a href="#section-4.5.2-4.3.1" class="pilcrow">Â¶</a></p>
<p id="section-4.5.2-4.3.2">
Note that, if the peer A is a CAPABLE device, it is able to store such information about the other peer B on disk and it <span class="bcp14">MUST</span> do so. This ensures that the peer A will perform every execution of KUDOS with the peer B in FS mode. In turn, this prevents a possible downgrading attack, aimed at making A believe that B is a non-CAPABLE device, and thus to run KUDOS in no-FS mode although the FS mode can actually be used by both peers.<a href="#section-4.5.2-4.3.2" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.5.2-5">Within the limitations above, two peers running KUDOS generate the new OSCORE Security Context CTX_NEW according to the mode indicated per the bit 'p' set by the responder in the second KUDOS message.<a href="#section-4.5.2-5" class="pilcrow">Â¶</a></p>
<p id="section-4.5.2-6">If, after having received the first KUDOS message, the responder can continue performing KUDOS, the bit 'p' in the reply message has the same value as in the bit 'p' set by the initiator, unless such latter value is 0 and the responder is a non-CAPABLE device. More specifically:<a href="#section-4.5.2-6" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-7.1">
              <p id="section-4.5.2-7.1.1">If both peers are CAPABLE devices, they will run KUDOS in FS mode. That is, both initiator and responder sets the 'p' bit to 0 in the respective sent KUDOS message.<a href="#section-4.5.2-7.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-7.2">
              <p id="section-4.5.2-7.2.1">If both peers are non-CAPABLE devices or only the peer acting as initiator is a non-CAPABLE device, they will run KUDOS in no-FS mode. That is, both initiator and responder sets the 'p' bit to 1 in the respective sent KUDOS message.<a href="#section-4.5.2-7.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-7.3">
              <p id="section-4.5.2-7.3.1">If only the peer acting as initiator is a CAPABLE device and it has knowledge of the other peer being a non-CAPABLE device, they will run KUDOS in no-FS mode. That is, both initiator and responder sets the 'p' bit to 1 in the respective sent KUDOS message.<a href="#section-4.5.2-7.3.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-7.4">
              <p id="section-4.5.2-7.4.1">If only the peer acting as initiator is a CAPABLE device and it has no knowledge of the other peer being a non-CAPABLE device, they will not run KUDOS in FS mode and will rather set to ground for possibly retrying in no-FS mode. In particular, the initiator sets the 'p' bit of its sent KUDOS message to 0. Then:<a href="#section-4.5.2-7.4.1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-7.4.2.1">
                  <p id="section-4.5.2-7.4.2.1.1">If the responder is a server, it <span class="bcp14">MUST</span> consider the KUDOS execution unsuccessful and <span class="bcp14">MUST</span> reply with a 5.03 (Service Unavailable) error response. The response <span class="bcp14">MUST</span> be protected with the newly derived OSCORE Security Context CTX_NEW. The diagnostic payload <span class="bcp14">MAY</span> provide additional information. This response is a KUDOS message, and it <span class="bcp14">MUST</span> have the 'd' bit and the 'p' bit set to 1.<a href="#section-4.5.2-7.4.2.1.1" class="pilcrow">Â¶</a></p>
<p id="section-4.5.2-7.4.2.1.2">
When receiving the error response, the initiator learns that the responder is a non-CAPABLE device (and hence not able to run KUDOS in FS mode), since the 'p' bit in the error response is set to 1, while the 'p' bit in the corresponding request was set to 0. Hence, the initiator <span class="bcp14">MUST</span> consider the KUDOS execution unsuccessful, and <span class="bcp14">MAY</span> try running KUDOS again. If it does so, the initiator <span class="bcp14">MUST</span> set the 'p' bit to 1, when sending a new request as first KUDOS message.<a href="#section-4.5.2-7.4.2.1.2" class="pilcrow">Â¶</a></p>
</li>
                <li class="normal" id="section-4.5.2-7.4.2.2">
                  <p id="section-4.5.2-7.4.2.2.1">If the responder is a client, it <span class="bcp14">MUST</span> consider the KUDOS execution unsuccessful and <span class="bcp14">MUST</span> send to the initiator the second KUDOS message as a new request, which <span class="bcp14">MUST</span> be protected with the newly derived OSCORE Security Context CTX_NEW. In the newly sent request, the 'p' bit <span class="bcp14">MUST</span> be set to 1.<a href="#section-4.5.2-7.4.2.2.1" class="pilcrow">Â¶</a></p>
<p id="section-4.5.2-7.4.2.2.2">
When receiving the new request above, the initiator learns that the responder is a non-CAPABLE device (and hence not able to run KUDOS in FS mode), since the 'p' bit in the request is set to 1, while the 'p' bit in the response previously sent as first KUDOS message was set to 0. Also, the initiator <span class="bcp14">SHOULD NOT</span> send any response to such a request, and the responder <span class="bcp14">SHOULD NOT</span> expect any such response.<a href="#section-4.5.2-7.4.2.2.2" class="pilcrow">Â¶</a></p>
</li>
              </ul>
<p id="section-4.5.2-7.4.3">
In either case, both KUDOS peers delete the OSCORE Security Contexts CTX_1 and CTX_NEW. Also, both peers <span class="bcp14">MUST</span> retain CTX_OLD for use during the next KUDOS execution in the no-FS mode. This is in contrast with the typical behavior where CTX_OLD is deleted upon reception of a message protected with CTX_NEW.<a href="#section-4.5.2-7.4.3" class="pilcrow">Â¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="preserving-observe">
<section id="section-4.6">
        <h3 id="name-preserving-observations-acr">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-preserving-observations-acr" class="section-name selfRef">Preserving Observations Across Key Updates</a>
        </h3>
<p id="section-4.6-1">As defined in <a href="#ssec-derive-ctx" class="auto internal xref">Section 4.3</a>, once a peer has completed the KUDOS execution and successfully derived the new OSCORE Security Context CTX_NEW, that peer normally terminates all the ongoing observations it has with the other peer <span>[<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, as protected with the old OSCORE Security Context CTX_OLD.<a href="#section-4.6-1" class="pilcrow">Â¶</a></p>
<p id="section-4.6-2">This section describes a method that the two peers can use to safely preserve the ongoing observations that they have with one another, beyond the completion of a KUDOS execution. In particular, this method ensures that an Observe notification can never successfully cryptographically match against the Observe requests of two different observations, e.g., against an Observe request protected with CTX_OLD and an Observe request protected with CTX_NEW.<a href="#section-4.6-2" class="pilcrow">Â¶</a></p>
<p id="section-4.6-3">The actual preservation of ongoing observations has to be agreed by the two peers at each execution of KUDOS that they run with one another, as defined in <a href="#preserving-observe-management" class="auto internal xref">Section 4.6.1</a>. If, at the end of a KUDOS execution, the two peers have not agreed on that, they <span class="bcp14">MUST</span> terminate the ongoing observations that they have with one another, just as defined in <a href="#ssec-context-handling" class="auto internal xref">Section 4.3.2</a>.<a href="#section-4.6-3" class="pilcrow">Â¶</a></p>
<div id="preserving-observe-management">
<section id="section-4.6.1">
          <h4 id="name-management-of-observations">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-management-of-observations" class="section-name selfRef">Management of Observations</a>
          </h4>
<p id="section-4.6.1-1">As per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>, a client can register its interest in observing a resource at a server, by sending a registration request including the Observe Option with value 0.<a href="#section-4.6.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-2">If the server registers the observation as ongoing, the server sends back a successful response also including the Observe Option, hence confirming that an entry has been successfully added for that client.<a href="#section-4.6.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-3">If the client receives back the successful response above from the server, then the client also registers the observation as ongoing.<a href="#section-4.6.1-3" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-4">In case the client can ever consider to preserve ongoing observations beyond a key update as defined below, then the client <span class="bcp14">MUST NOT</span> simply forget about an ongoing observation if not interested in it anymore. Instead, the client <span class="bcp14">MUST</span> send an explicit cancellation request to the server, i.e., a request including the Observe Option with value 1 (see <span><a href="https://rfc-editor.org/rfc/rfc7641#section-3.6" class="relref">Section 3.6</a> of [<a href="#RFC7641" class="cite xref">RFC7641</a>]</span>). After sending this cancellation request, if the client does not receive back a response confirming that the observation has been terminated, the client <span class="bcp14">MUST NOT</span> consider the observation terminated. The client <span class="bcp14">MAY</span> try again to terminate the observation by sending a new cancellation request.<a href="#section-4.6.1-4" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-5">In case a peer A performs a KUDOS execution with another peer B, and A has ongoing observations with B that it is interested to preserve beyond the key update, then A can explicitly indicate its interest to do so. To this end, the peer A sets to 1 the bit "Preserve Observations", 'b', in the 'x' byte of the OSCORE Option value (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>), in the KUDOS message it sends to the other peer B.<a href="#section-4.6.1-5" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-6">If a peer acting as responder receives the first KUDOS message with the bit 'b' set to 0, then the peer <span class="bcp14">MUST</span> set to 0 the bit 'b' in the KUDOS message it sends as follow-up, regardless of its wish to preserve ongoing observations with the other peer.<a href="#section-4.6.1-6" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-7">If a peer acting as initiator has sent the first KUDOS message with the bit 'b' set to 0, the peer <span class="bcp14">MUST</span> ignore the bit 'b' in the follow-up KUDOS message that it receives from the other peer.<a href="#section-4.6.1-7" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-8">After successfully completing the KUDOS execution (i.e., after having successfully derived the new OSCORE Security Context CTX_NEW), both peers have expressed their interest in preserving their common ongoing observations if and only if the bit 'b' was set to 1 in both the exchanged KUDOS messages. In such a case, each peer X performs the following actions.<a href="#section-4.6.1-8" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.6.1-9">
<li id="section-4.6.1-9.1">
              <p id="section-4.6.1-9.1.1">The peer X considers all the still ongoing observations that it has with the other peer, such that X acts as client in those observations. If there are no such observations, the peer X takes no further actions. Otherwise, it moves to step 2.<a href="#section-4.6.1-9.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.6.1-9.2">
              <p id="section-4.6.1-9.2.1">The peer X considers all the OSCORE Partial IV values used in the Observe registration request associated with any of the still ongoing observations determined at step 1.<a href="#section-4.6.1-9.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.6.1-9.3">
              <p id="section-4.6.1-9.3.1">The peer X determines the value PIV* as the highest OSCORE Partial IV value among those considered at step 2.<a href="#section-4.6.1-9.3.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="section-4.6.1-9.4">
              <p id="section-4.6.1-9.4.1">In the Sender Context of the OSCORE Security Context shared with the other peer, the peer X sets its own Sender Sequence Number to (PIV* + 1), rather than to 0.<a href="#section-4.6.1-9.4.1" class="pilcrow">Â¶</a></p>
</li>
          </ol>
<p id="section-4.6.1-10">As a result, each peer X will "jump" beyond the OSCORE Partial IV (PIV) values that are occupied and in use for ongoing observations with the other peer where X acts as client.<a href="#section-4.6.1-10" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-11">Note that, each time it runs KUDOS, a peer must determine if it wishes to preserve ongoing observations with the other peer or not, before sending its KUDOS message.<a href="#section-4.6.1-11" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-12">To this end, the peer should also assess the new value that PIV* would take after a successful completion of KUDOS, in case ongoing observations with the other peer are going to be preserved. If the peer considers such a new value of PIV* to be too close to or equal to the maximum possible value admitted for the OSCORE Partial IV, then the peer may choose to run KUDOS with no intention to preserve its ongoing observations with the other peer, in order to "start over" from a fresh, entirely unused PIV space.<a href="#section-4.6.1-12" class="pilcrow">Â¶</a></p>
<p id="section-4.6.1-13">Application policies can further influence whether attempting to preserve observations beyond a key update is appropriate or not.<a href="#section-4.6.1-13" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssec-retention">
<section id="section-4.7">
        <h3 id="name-retention-policies">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-retention-policies" class="section-name selfRef">Retention Policies</a>
        </h3>
<p id="section-4.7-1">Applications <span class="bcp14">MAY</span> define policies that allow a peer to temporarily keep the old Security Context CTX_OLD beyond having established the new Security Context CTX_NEW and having achieved key confirmation, rather than simply overwriting CTX_OLD with CTX_NEW. This allows the peer to decrypt late, still on-the-fly incoming messages protected with CTX_OLD.<a href="#section-4.7-1" class="pilcrow">Â¶</a></p>
<p id="section-4.7-2">When enforcing such policies, the following applies.<a href="#section-4.7-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7-3.1">
            <p id="section-4.7-3.1.1">Outgoing non KUDOS messages <span class="bcp14">MUST</span> be protected by using only CTX_NEW.<a href="#section-4.7-3.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.7-3.2">
            <p id="section-4.7-3.2.1">Incoming non KUDOS messages <span class="bcp14">MUST</span> first be attempted to decrypt by using CTX_NEW. If decryption fails, a second attempt can use CTX_OLD.<a href="#section-4.7-3.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.7-3.3">
            <p id="section-4.7-3.3.1">When an amount of time defined by the policy has elapsed since the establishment of CTX_NEW, the peer deletes CTX_OLD.<a href="#section-4.7-3.3.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-4.7-4">A peer <span class="bcp14">MUST NOT</span> retain CTX_OLD beyond the establishment of CTX_NEW and the achievement of key confirmation, if any of the following conditions holds: CTX_OLD is expired; limits set for safe key usage have been reached <span>[<a href="#I-D.ietf-core-oscore-key-limits" class="cite xref">I-D.ietf-core-oscore-key-limits</a>]</span>, for the Recipient Key of the Recipient Context of CTX_OLD.<a href="#section-4.7-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ssec-discussion">
<section id="section-4.8">
        <h3 id="name-discussion">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-discussion" class="section-name selfRef">Discussion</a>
        </h3>
<p id="section-4.8-1">KUDOS is intended to deprecate and replace the procedure defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, as fundamentally achieving the same goal, while displaying a number of improvements and advantages.<a href="#section-4.8-1" class="pilcrow">Â¶</a></p>
<p id="section-4.8-2">In particular, it is especially convenient for the handling of failure events concerning the JRC node in 6TiSCH networks (see <a href="#sec-current-methods" class="auto internal xref">Section 2</a>). That is, among its intrinsic advantages compared to the procedure defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, KUDOS preserves the same ID Context value, when establishing a new OSCORE Security Context.<a href="#section-4.8-2" class="pilcrow">Â¶</a></p>
<p id="section-4.8-3">Since the JRC uses ID Context values as identifiers of network nodes, namely "pledge identifiers", the above implies that the JRC does not have to perform anymore a mapping between a new, different ID Context value and a certain pledge identifier (see <span><a href="https://rfc-editor.org/rfc/rfc9031#section-8.3.3" class="relref">Section 8.3.3</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>). It follows that pledge identifiers can remain constant once assigned, and thus ID Context values used as pledge identifiers can be employed in the long-term as originally intended.<a href="#section-4.8-3" class="pilcrow">Â¶</a></p>
<div id="kudos-interleaved-with-other-message-exchanges">
<section id="section-4.8.1">
          <h4 id="name-kudos-interleaved-with-othe">
<a href="#section-4.8.1" class="section-number selfRef">4.8.1. </a><a href="#name-kudos-interleaved-with-othe" class="section-name selfRef">KUDOS Interleaved with Other Message Exchanges</a>
          </h4>
<p id="section-4.8.1-1">During a KUDOS execution, a peer that is a CoAP Client must be ready to receive CoAP responses that are not KUDOS messages and that are protected with a different OSCORE Security Context than the one that was used to protect the corresponding request.<a href="#section-4.8.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.8.1-2">This can happen, for instance, when a CoAP client sends a request and, shortly after that, it executes KUDOS. In such a case, the CoAP request is protected with CTX_OLD, while the CoAP response from the server is protected with CTX_NEW. Another case is when incoming responses are Observe notifications protected with CTX_NEW, while the corresponding request from the CoAP client that started the observation was protected with CTX_OLD.<a href="#section-4.8.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.8.1-3">Another case is when running KUDOS in the reverse message flow, if the client uses NSTART &gt; 1 and one of its requests triggers a KUDOS execution, i.e., the server replies with the first KUDOS message by acting as responder. The other requests would be latest served by the server after KUDOS has been completed.<a href="#section-4.8.1-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="communication-overhead">
<section id="section-4.8.2">
          <h4 id="name-communication-overhead">
<a href="#section-4.8.2" class="section-number selfRef">4.8.2. </a><a href="#name-communication-overhead" class="section-name selfRef">Communication Overhead</a>
          </h4>
<p id="section-4.8.2-1">Each of the two KUDOS messages displays a small communication overhead. This is determined by the following, additional information conveyed in the OSCORE option (see <a href="#ssec-oscore-option-extensions" class="auto internal xref">Section 4.1</a>).<a href="#section-4.8.2-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2-2.1">
              <p id="section-4.8.2-2.1.1">The second byte of the OSCORE option.<a href="#section-4.8.2-2.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-2.2">
              <p id="section-4.8.2-2.2.1">The byte 'x' of the OSCORE option.<a href="#section-4.8.2-2.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-2.3">
              <p id="section-4.8.2-2.3.1">The nonce conveyed in the 'nonce' field of the OSCORE option. Its size ranges from 1 to 16 bytes as indicated in the 'x' byte, and is typically of 8 bytes.<a href="#section-4.8.2-2.3.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="section-4.8.2-3">Assuming nonces of the same size in both messages of the same KUDOS execution, this results in the following minimum, typical, and maximum communication overhead, when considering a nonce with size 1, 8, and 16 bytes, respectively. All the indicated values are in bytes.<a href="#section-4.8.2-3" class="pilcrow">Â¶</a></p>
<span id="name-communication-overhead-forw"></span><div id="_table-overhead-forward">
<table class="center" id="table-1">
            <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-communication-overhead-forw" class="selfRef">Communication overhead (forward message flow)</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Nonce size</th>
                <th class="text-left" rowspan="1" colspan="1">First KUDOS message</th>
                <th class="text-left" rowspan="1" colspan="1">Second KUDOS message</th>
                <th class="text-left" rowspan="1" colspan="1">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">6</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">10</td>
                <td class="text-left" rowspan="1" colspan="1">10</td>
                <td class="text-left" rowspan="1" colspan="1">20</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">18</td>
                <td class="text-left" rowspan="1" colspan="1">18</td>
                <td class="text-left" rowspan="1" colspan="1">36</td>
              </tr>
            </tbody>
          </table>
</div>
<span id="name-communication-overhead-reve"></span><div id="_table-overhead-reverse">
<table class="center" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-communication-overhead-reve" class="selfRef">Communication overhead (reverse message flow)</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Nonce size</th>
                <th class="text-left" rowspan="1" colspan="1">First KUDOS message</th>
                <th class="text-left" rowspan="1" colspan="1">Second KUDOS message</th>
                <th class="text-left" rowspan="1" colspan="1">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">7</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">10</td>
                <td class="text-left" rowspan="1" colspan="1">11</td>
                <td class="text-left" rowspan="1" colspan="1">21</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">18</td>
                <td class="text-left" rowspan="1" colspan="1">19</td>
                <td class="text-left" rowspan="1" colspan="1">37</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
<div id="well-known-kudos-desc">
<section id="section-4.8.3">
          <h4 id="name-well-known-kudos-resource">
<a href="#section-4.8.3" class="section-number selfRef">4.8.3. </a><a href="#name-well-known-kudos-resource" class="section-name selfRef">Well-Known KUDOS Resource</a>
          </h4>
<p id="section-4.8.3-1">According to this specification, KUDOS is transferred in POST requests and 2.04 (Changed) responses. If a client wishes to execute the KUDOS procedure as initiator without triggering any application processing on the server, then the request sent as first KUDOS message must target a KUDOS resource, e.g., at the Uri-Path "/.well-known/kudos" (see <a href="#well-known-kudos" class="auto internal xref">Section 6.4</a>), or at an alternative Uri-Path that can be discovered, e.g., by using a resource directory <span>[<a href="#RFC9176" class="cite xref">RFC9176</a>]</span>.<a href="#section-4.8.3-1" class="pilcrow">Â¶</a></p>
<p id="section-4.8.3-2">In order to discover a server's well-known KUDOS resource and possible other KUDOS resources, client applications can use the resource type "core.kudos" (see <a href="#rt-kudos" class="auto internal xref">Section 6.5</a>).<a href="#section-4.8.3-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="rekeying-when-using-schc-with-oscore">
<section id="section-4.8.4">
          <h4 id="name-rekeying-when-using-schc-wi">
<a href="#section-4.8.4" class="section-number selfRef">4.8.4. </a><a href="#name-rekeying-when-using-schc-wi" class="section-name selfRef">Rekeying when Using SCHC with OSCORE</a>
          </h4>
<p id="section-4.8.4-1">In the interest of rekeying, the following points must be taken into account when using the Static Context Header Compression and fragmentation (SCHC) framework <span>[<a href="#RFC8724" class="cite xref">RFC8724</a>]</span> for compressing CoAP messages protected with OSCORE, as defined in <span>[<a href="#RFC8824" class="cite xref">RFC8824</a>]</span>.<a href="#section-4.8.4-1" class="pilcrow">Â¶</a></p>
<p id="section-4.8.4-2">Compression of the OSCORE Partial IV has implications for the frequency of rekeying. That is, if the Partial IV is compressed, the communicating peers must perform rekeying more often, as the available Partial IV space becomes smaller due to the compression. For instance, if only 3 bits of the Partial IV are sent, then the maximum PIV before having to rekey is only 2^3 - 1 = 7.<a href="#section-4.8.4-2" class="pilcrow">Â¶</a></p>
<p id="section-4.8.4-3">Furthermore, any time the SCHC context Rules are updated on an OSCORE endpoint, that endpoint must perform a rekeying (see <span><a href="https://rfc-editor.org/rfc/rfc8824#section-9" class="relref">Section 9</a> of [<a href="#RFC8824" class="cite xref">RFC8824</a>]</span>).<a href="#section-4.8.4-3" class="pilcrow">Â¶</a></p>
<p id="section-4.8.4-4">That is, the use of SCHC plays a role in triggering KUDOS executions and in affecting their cadence. Hence, the used SCHC Rules and their update policies should ensure that the KUDOS executions occurring as their side effect do not significantly impair the gain from message compression.<a href="#section-4.8.4-4" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="edhoc-ead-signaling">
<section id="section-4.9">
        <h3 id="name-signaling-kudos-support-in-">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-signaling-kudos-support-in-" class="section-name selfRef">Signaling KUDOS support in EDHOC</a>
        </h3>
<p id="section-4.9-1">The EDHOC protocol defines the transport of additional External Authorization Data (EAD) within an optional EAD field of the EDHOC messages (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8" class="relref">Section 3.8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>). An EAD field is composed of one or multiple EAD items, each of which specifies an identifying 'ead_label' encoded as a CBOR integer, and an optional 'ead_value' encoded as a CBOR bstr.<a href="#section-4.9-1" class="pilcrow">Â¶</a></p>
<p id="section-4.9-2">This document defines a new EDHOC EAD item KUDOS_EAD and registers its 'ead_label' in <a href="#iana-edhoc-aad" class="auto internal xref">Section 6.3</a>. By including this EAD item in an outgoing EDHOC message, a sender peer can indicate whether it supports KUDOS and in which modes, as well as query the other peer about its support. Note that peers do not have to use this EDHOC EAD item to be able to run KUDOS with each other, irrespective of the modes they support. A KUDOS peer <span class="bcp14">MUST</span> only use the EDHOC EAD item KUDOS_EAD as non-critical. That is, when included in an EDHOC message, its 'ead_label' <span class="bcp14">MUST</span> be used with positive sign. The possible values of the 'ead_value' are as follows:<a href="#section-4.9-2" class="pilcrow">Â¶</a></p>
<span id="name-values-for-the-edhoc-ead-it"></span><div id="_table-kudos-ead">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-values-for-the-edhoc-ead-it" class="selfRef">Values for the EDHOC EAD item KUDOS_EAD</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ASK</td>
              <td class="text-left" rowspan="1" colspan="1">h'' (0x40)</td>
              <td class="text-left" rowspan="1" colspan="1">Used only in EDHOC message_1. It asks the recipient peer to specify in EDHOC message_2 whether it supports KUDOS.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NONE</td>
              <td class="text-left" rowspan="1" colspan="1">h'00' (0x4100)</td>
              <td class="text-left" rowspan="1" colspan="1">Used only in EDHOC message_2 and message_3. It specifies that the sender peer does not support KUDOS.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">FULL</td>
              <td class="text-left" rowspan="1" colspan="1">h'01' (0x4101)</td>
              <td class="text-left" rowspan="1" colspan="1">Used only in EDHOC message_2 and message_3. It specifies that the sender peer supports KUDOS in FS mode and no-FS mode.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">PART</td>
              <td class="text-left" rowspan="1" colspan="1">h'02' (0x4102)</td>
              <td class="text-left" rowspan="1" colspan="1">Used only in EDHOC message_2 and message_3. It specifies that the sender peer supports KUDOS in no-FS mode only.</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-4.9-4">When the KUDOS_EAD item is included in EDHOC message_1 with 'ead_value' ASK, a recipient peer that supports the KUDOS_EAD item <span class="bcp14">MUST</span> specify whether it supports KUDOS in EDHOC message_2.<a href="#section-4.9-4" class="pilcrow">Â¶</a></p>
<p id="section-4.9-5">When the KUDOS_EAD item is not included in EDHOC message_1 with 'ead_value' ASK, a recipient peer that supports the KUDOS_EAD item <span class="bcp14">MAY</span> still specify whether it supports KUDOS in EDHOC message_2.<a href="#section-4.9-5" class="pilcrow">Â¶</a></p>
<p id="section-4.9-6">When the KUDOS_EAD item is included in EDHOC message_2 with 'ead_value' FULL or PART, a recipient peer that supports the KUDOS_EAD item <span class="bcp14">SHOULD</span> specify whether it supports KUDOS in EDHOC message_3. An exception applies in case, based on application policies or other context information, the recipient peer that receives EDHOC message_2 already knows that the sender peer is supposed to have such knowledge.<a href="#section-4.9-6" class="pilcrow">Â¶</a></p>
<p id="section-4.9-7">When the KUDOS_EAD item is included in EDHOC message_2 with 'ead_value' NONE, a recipient peer that supports the KUDOS_EAD item <span class="bcp14">MUST NOT</span> specify whether it supports KUDOS in EDHOC message_3.<a href="#section-4.9-7" class="pilcrow">Â¶</a></p>
<p id="section-4.9-8">In the following cases, the recipient peer silently ignores the KUDOS_EAD item specified in the received EDHOC message, and does not include a KUDOS_EAD item in the next EDHOC message it sends (if any).<a href="#section-4.9-8" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.9-9.1">
            <p id="section-4.9-9.1.1">The recipient peer does not support the KUDOS_EAD item.<a href="#section-4.9-9.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.9-9.2">
            <p id="section-4.9-9.2.1">The KUDOS_EAD item is included in EDHOC message_1 with 'ead_value' different than ASK<a href="#section-4.9-9.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.9-9.3">
            <p id="section-4.9-9.3.1">The KUDOS_EAD item is included in EDHOC message_2 or message_3 with 'ead_value' ASK.<a href="#section-4.9-9.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-4.9-9.4">
            <p id="section-4.9-9.4.1">The KUDOS_EAD item is included in EDHOC message_4.<a href="#section-4.9-9.4.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
<p id="section-4.9-10">That is, by specifying 'ead_value' ASK in EDHOC message_1, a peer A can indicate to the other peer B that it wishes to know if B supports KUDOS and in what mode(s). In the following EDHOC message_2, B indicates whether it supports KUDOS and in what mode(s), by specifying either NONE, FULL, or PART as 'ead_value'. Specifying the 'ead_value' FULL or PART in EDHOC message_2 also asks A to indicate whether it supports KUDOS in EDHOC message_3.<a href="#section-4.9-10" class="pilcrow">Â¶</a></p>
<p id="section-4.9-11">To further illustrate the functionality, two examples are presented below as EDHOC executions where only the new KUDOS_EAD item is shown when present, and assuming that no other EAD items are used by the two peers.<a href="#section-4.9-11" class="pilcrow">Â¶</a></p>
<div id="section-4.9-12">
          <div class="alignCenter art-svg artwork" id="section-4.9-12.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="272" width="480" viewBox="0 0 480 272" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,64 L 8,256" fill="none" stroke="black"></path>
              <path d="M 472,64 L 472,256" fill="none" stroke="black"></path>
              <path d="M 8,96 L 464,96" fill="none" stroke="black"></path>
              <path d="M 16,160 L 472,160" fill="none" stroke="black"></path>
              <path d="M 8,224 L 464,224" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="472,224 460,218.4 460,229.6" fill="black" transform="rotate(0,464,224)"></polygon>
              <polygon class="arrowhead" points="472,96 460,90.4 460,101.6" fill="black" transform="rotate(0,464,96)"></polygon>
              <polygon class="arrowhead" points="24,160 12,154.4 12,165.6" fill="black" transform="rotate(180,16,160)"></polygon>
              <g class="text">
                <text x="24" y="36">EDHOC</text>
                <text x="456" y="36">EDHOC</text>
                <text x="40" y="52">Initiator</text>
                <text x="440" y="52">Responder</text>
                <text x="164" y="84">EAD_1:</text>
                <text x="240" y="84">(TBD_LABEL,</text>
                <text x="308" y="84">ASK)</text>
                <text x="240" y="116">message_1</text>
                <text x="164" y="148">EAD_2:</text>
                <text x="240" y="148">(TBD_LABEL,</text>
                <text x="312" y="148">FULL)</text>
                <text x="240" y="180">message_2</text>
                <text x="164" y="212">EAD_3:</text>
                <text x="240" y="212">(TBD_LABEL,</text>
                <text x="312" y="212">FULL)</text>
                <text x="240" y="244">message_3</text>
              </g>
            </svg><a href="#section-4.9-12.1" class="pilcrow">Â¶</a>
</div>
</div>
<p id="section-4.9-13">In the example above, the Initiator asks the EDHOC Responder about its support for KUDOS ('ead_value' = ASK). In EDHOC message_2, the Responder indicates that it supports both the FS and no-FS mode of KUDOS ('ead_value' = FULL). Finally, in EDHOC message_3, the Initiator indicates that it also supports both the FS and no-FS mode of KUDOS ('ead_value' = FULL). After the EDHOC execution has successfully finished, both peers are aware that they both support KUDOS, in the FS and no-FS modes.<a href="#section-4.9-13" class="pilcrow">Â¶</a></p>
<div id="section-4.9-14">
          <div class="alignCenter art-svg artwork" id="section-4.9-14.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="256" width="480" viewBox="0 0 480 256" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,64 L 8,240" fill="none" stroke="black"></path>
              <path d="M 472,64 L 472,240" fill="none" stroke="black"></path>
              <path d="M 8,96 L 464,96" fill="none" stroke="black"></path>
              <path d="M 16,160 L 472,160" fill="none" stroke="black"></path>
              <path d="M 8,208 L 464,208" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="472,208 460,202.4 460,213.6" fill="black" transform="rotate(0,464,208)"></polygon>
              <polygon class="arrowhead" points="472,96 460,90.4 460,101.6" fill="black" transform="rotate(0,464,96)"></polygon>
              <polygon class="arrowhead" points="24,160 12,154.4 12,165.6" fill="black" transform="rotate(180,16,160)"></polygon>
              <g class="text">
                <text x="24" y="36">EDHOC</text>
                <text x="456" y="36">EDHOC</text>
                <text x="40" y="52">Initiator</text>
                <text x="440" y="52">Responder</text>
                <text x="164" y="84">EAD_1:</text>
                <text x="240" y="84">(TBD_LABEL,</text>
                <text x="308" y="84">ASK)</text>
                <text x="240" y="116">message_1</text>
                <text x="164" y="148">EAD_2:</text>
                <text x="240" y="148">(TBD_LABEL,</text>
                <text x="312" y="148">NONE)</text>
                <text x="240" y="180">message_2</text>
                <text x="240" y="228">message_3</text>
              </g>
            </svg><a href="#section-4.9-14.1" class="pilcrow">Â¶</a>
</div>
</div>
<p id="section-4.9-15">In this second example, the Initiator asks the EDHOC Responder about its support for KUDOS ('ead_value' = ASK). In EDHOC message_2, the Responder indicates that it does not support KUDOS at all ('ead_value' = NONE). Finally, in EDHOC message_3, the Initiator does not include the KUDOS_EAD item, since it already knows that using KUDOS with the other peer will not be possible. After the EDHOC execution has successfully finished, the Initiator is aware that the Responder does not support KUDOS, which the two peers are not going to use with each other.<a href="#section-4.9-15" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-cons">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">Depending on the specific key update procedure used to establish a new OSCORE Security Context, the related security considerations also apply.<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<p id="section-5-2">As mentioned in <a href="#ssec-nonces-x-bytes" class="auto internal xref">Section 4.3.1</a>, it is <span class="bcp14">RECOMMENDED</span> that the size for nonces N1 and N2 is 8 bytes. The application needs to set the size of each nonce such that the probability of its value being repeated is negligible. Note that the probability of collision of nonce values is heightened by the birthday paradox. However, considering a nonce size of 8 bytes there will be a collision on average after approximately 2^32 instances of Response #1 messages.<a href="#section-5-2" class="pilcrow">Â¶</a></p>
<p id="section-5-3">Overall, the size of the nonces N1 and N2 should be set such that the security level is harmonized with other components of the deployment. Considering the constraints of embedded implementations, there might be a need for allowing N1 and N2 values that are smaller in size. This is acceptable, provided that safety, reliability, and robustness within the system can still be assured. Although using nonces that are smaller in size means that there will be a collision on average after fewer KUDOS messages have been sent, this should not pose significant problems even for a constrained server operating at a capacity of one request per second.<a href="#section-5-3" class="pilcrow">Â¶</a></p>
<p id="section-5-4">The nonces exchanged in the KUDOS messages are sent in the clear, so using random nonces is preferable for maintaining privacy. If instead a counter value is used, this can leak some information about the peers. Specifically, using counters will reveal the frequency of rekeying procedures performed.<a href="#section-5-4" class="pilcrow">Â¶</a></p>
<p id="section-5-5">As discussed in <span>[<a href="#Symmetric-Security" class="cite xref">Symmetric-Security</a>]</span>, key update methods built on symmetric key exchange have weaker security properties compared to methods built on ephemeral Diffie-Hellman key exchange. In fact, while the two approaches can co-exist, rekeying with symmetric key exchange is not intended as a substitute for ephemeral Diffie-Hellman key exchange. Peers should periodically perform a key update based on ephemeral Diffie-Hellman key exchange (e.g., by running the EDHOC protocol <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>). The cadence of such periodic key updates should be determined based on how much the two peers and their network environment are constrained, as well as on the maximum amount of time and of exchanged data that are acceptable between two consecutive key updates.<a href="#section-5-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sec-iana">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">This document has the following actions for IANA.<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<p id="section-6-2">Note to RFC Editor: Please replace all occurrences of "[RFC-XXXX]" with the RFC number of this specification and delete this paragraph.<a href="#section-6-2" class="pilcrow">Â¶</a></p>
<div id="iana-cons-flag-bits">
<section id="section-6.1">
        <h3 id="name-oscore-flag-bits-registry">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-oscore-flag-bits-registry" class="section-name selfRef">OSCORE Flag Bits Registry</a>
        </h3>
<p id="section-6.1-1">IANA is asked to add the following entries to the "OSCORE Flag Bits" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-6.1-1" class="pilcrow">Â¶</a></p>
<span id="name-registrations-in-the-oscore"></span><div id="_table-iana-oscore-flag-bits">
<table class="center" id="table-4">
          <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-registrations-in-the-oscore" class="selfRef">Registrations in the OSCORE Flag Bits Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Bit Position</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-1 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies a second byte, which includes the OSCORE flag bits 8-15</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-2 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies a third byte, which includes the OSCORE flag bits 16-23</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">15</td>
              <td class="text-left" rowspan="1" colspan="1">Nonce Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if nonce is present in the compressed COSE object</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">16</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-3 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies a fourth byte, which includes the OSCORE flag bits 24-31</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">24</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-4 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies a fifth byte, which includes the OSCORE flag bits 32-39</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-5 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies a sixth byte, which includes the OSCORE flag bits 40-47</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">40</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-6 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies a seventh byte, which includes the OSCORE flag bits 48-55</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">48</td>
              <td class="text-left" rowspan="1" colspan="1">Extension-7 Flag</td>
              <td class="text-left" rowspan="1" colspan="1">Set to 1 if the OSCORE Option specifies an eigth byte, which includes the OSCORE flag bits 56-63</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-6.1-3">In the same registry, IANA is asked to mark as 'Unassigned' the entry with Bit Position of 1, i.e., to update the entry as follows.<a href="#section-6.1-3" class="pilcrow">Â¶</a></p>
<span id="name-update-in-the-oscore-flag-b"></span><div id="_table-iana-oscore-flag-bits-2">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-update-in-the-oscore-flag-b" class="selfRef">Update in the OSCORE Flag Bits Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Bit Position</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
              <td class="text-left" rowspan="1" colspan="1">Â </td>
              <td class="text-left" rowspan="1" colspan="1">Â </td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="coap-option-numbers-registry">
<section id="section-6.2">
        <h3 id="name-coap-option-numbers-registr">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-coap-option-numbers-registr" class="section-name selfRef">CoAP Option Numbers Registry</a>
        </h3>
<p id="section-6.2-1">IANA is asked to add this document as a reference for the OSCORE Option in the "CoAP Option Numbers" registry within the "Constrained RESTful Environments (CoRE) Parameters" registry group.<a href="#section-6.2-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="iana-edhoc-aad">
<section id="section-6.3">
        <h3 id="name-edhoc-external-authorizatio">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-edhoc-external-authorizatio" class="section-name selfRef">EDHOC External Authorization Data Registry</a>
        </h3>
<p id="section-6.3-1">IANA is asked to add the following entries to the "EDHOC External Authorization Data" registry defined in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-10.5" class="relref">Section 10.5</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> within the "Ephemeral Diffie-Hellman Over COSE (EDHOC)" registry group.<a href="#section-6.3-1" class="pilcrow">Â¶</a></p>
<span id="name-registrations-in-the-edhoc-"></span><div id="_table-iana-edhoc-ead">
<table class="center" id="table-6">
          <caption>
<a href="#table-6" class="selfRef">Table 6</a>:
<a href="#name-registrations-in-the-edhoc-" class="selfRef">Registrations in the EDHOC External Authorization Data Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Label</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TBD1</td>
              <td class="text-left" rowspan="1" colspan="1">Indicates whether this peer supports KUDOS and in which mode(s)</td>
              <td class="text-left" rowspan="1" colspan="1">[RFC-XXXX]</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="well-known-kudos">
<section id="section-6.4">
        <h3 id="name-the-well-known-uri-registry">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-the-well-known-uri-registry" class="section-name selfRef">The Well-Known URI Registry</a>
        </h3>
<p id="section-6.4-1">IANA is asked to add the 'kudos' well-known URI to the Well-Known URIs registry as defined by <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>.<a href="#section-6.4-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-2.1">
            <p id="section-6.4-2.1.1">URI suffix: kudos<a href="#section-6.4-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-6.4-2.2">
            <p id="section-6.4-2.2.1">Change controller: IETF<a href="#section-6.4-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-6.4-2.3">
            <p id="section-6.4-2.3.1">Specification document(s): [RFC-XXXX]<a href="#section-6.4-2.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-6.4-2.4">
            <p id="section-6.4-2.4.1">Related information: None<a href="#section-6.4-2.4.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="rt-kudos">
<section id="section-6.5">
        <h3 id="name-resource-type-rt-link-targe">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-resource-type-rt-link-targe" class="section-name selfRef">Resource Type (rt=) Link Target Attribute Values Registry</a>
        </h3>
<p id="section-6.5-1">IANA is requested to add the resource type "core.kudos" to the "Resource Type (rt=) Link Target Attribute Values" registry under the registry group "Constrained RESTful Environments (CoRE) Parameters".<a href="#section-6.5-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.5-2.1">
            <p id="section-6.5-2.1.1">Value: "core.kudos"<a href="#section-6.5-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-6.5-2.2">
            <p id="section-6.5-2.2.1">Description: KUDOS resource.<a href="#section-6.5-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-6.5-2.3">
            <p id="section-6.5-2.3.1">Reference: [RFC-XXXX]<a href="#section-6.5-2.3.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7641">https://www.rfc-editor.org/rfc/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9528">[RFC9528]</dt>
      <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">PreuÃ Mattsson, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="seriesInfo">RFC 9528</span>, <span class="seriesInfo">DOI 10.17487/RFC9528</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9528">https://www.rfc-editor.org/rfc/rfc9528</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ace-edhoc-oscore-profile">[I-D.ietf-ace-edhoc-oscore-profile]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Tiloca, M.</span>, and <span class="refAuthor">R. HÃ¶glund</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC) and Object Security for Constrained Environments (OSCORE) Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-edhoc-oscore-profile-05</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-edhoc-oscore-profile-05">https://datatracker.ietf.org/doc/html/draft-ietf-ace-edhoc-oscore-profile-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-key-limits">[I-D.ietf-core-oscore-key-limits]</dt>
        <dd>
<span class="refAuthor">HÃ¶glund, R.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Key Usage Limits for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-key-limits-03</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-limits-03">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-limits-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-aead-limits">[I-D.irtf-cfrg-aead-limits]</dt>
        <dd>
<span class="refAuthor">GÃ¼nther, F.</span>, <span class="refAuthor">Thomson, M.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Usage Limits on AEAD Algorithms"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-aead-limits-08</span>, <time datetime="2024-04-01" class="refDate">1 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-08">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LwM2M">[LwM2M]</dt>
        <dd>
<span class="refAuthor">Open Mobile Alliance</span>, <span class="refTitle">"Lightweight Machine to Machine Technical Specification - Core, Approved Version 1.2, OMA-TS-LightweightM2M_Core-V1_2-20201110-A"</span>, <time datetime="2020-11" class="refDate">November 2020</time>, <span>&lt;<a href="http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Core-V1_2-20201110-A.pdf">http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Core-V1_2-20201110-A.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LwM2M-Transport">[LwM2M-Transport]</dt>
        <dd>
<span class="refAuthor">Open Mobile Alliance</span>, <span class="refTitle">"Lightweight Machine to Machine Technical Specification - Transport Bindings, Approved Version 1.2, OMA-TS-LightweightM2M_Transport-V1_2-20201110-A"</span>, <time datetime="2020-11" class="refDate">November 2020</time>, <span>&lt;<a href="http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Transport-V1_2-20201110-A.pdf">http://www.openmobilealliance.org/release/LightweightM2M/V1_2-20201110-A/OMA-TS-LightweightM2M_Transport-V1_2-20201110-A.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7554">[RFC7554]</dt>
        <dd>
<span class="refAuthor">Watteyne, T., Ed.</span>, <span class="refAuthor">Palattella, M.</span>, and <span class="refAuthor">L. Grieco</span>, <span class="refTitle">"Using IEEE 802.15.4e Time-Slotted Channel Hopping (TSCH) in the Internet of Things (IoT): Problem Statement"</span>, <span class="seriesInfo">RFC 7554</span>, <span class="seriesInfo">DOI 10.17487/RFC7554</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7554">https://www.rfc-editor.org/rfc/rfc7554</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7967">[RFC7967]</dt>
        <dd>
<span class="refAuthor">Bhattacharyya, A.</span>, <span class="refAuthor">Bandyopadhyay, S.</span>, <span class="refAuthor">Pal, A.</span>, and <span class="refAuthor">T. Bose</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Option for No Server Response"</span>, <span class="seriesInfo">RFC 7967</span>, <span class="seriesInfo">DOI 10.17487/RFC7967</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7967">https://www.rfc-editor.org/rfc/rfc7967</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8180">[RFC8180]</dt>
        <dd>
<span class="refAuthor">Vilajosana, X., Ed.</span>, <span class="refAuthor">Pister, K.</span>, and <span class="refAuthor">T. Watteyne</span>, <span class="refTitle">"Minimal IPv6 over the TSCH Mode of IEEE 802.15.4e (6TiSCH) Configuration"</span>, <span class="seriesInfo">BCP 210</span>, <span class="seriesInfo">RFC 8180</span>, <span class="seriesInfo">DOI 10.17487/RFC8180</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8180">https://www.rfc-editor.org/rfc/rfc8180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8615">[RFC8615]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 8615</span>, <span class="seriesInfo">DOI 10.17487/RFC8615</span>, <time datetime="2019-05" class="refDate">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8615">https://www.rfc-editor.org/rfc/rfc8615</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8724">[RFC8724]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, <span class="refAuthor">Gomez, C.</span>, <span class="refAuthor">Barthel, D.</span>, and <span class="refAuthor">JC. Zuniga</span>, <span class="refTitle">"SCHC: Generic Framework for Static Context Header Compression and Fragmentation"</span>, <span class="seriesInfo">RFC 8724</span>, <span class="seriesInfo">DOI 10.17487/RFC8724</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8724">https://www.rfc-editor.org/rfc/rfc8724</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8824">[RFC8824]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, and <span class="refAuthor">R. Andreasen</span>, <span class="refTitle">"Static Context Header Compression (SCHC) for the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 8824</span>, <span class="seriesInfo">DOI 10.17487/RFC8824</span>, <time datetime="2021-06" class="refDate">June 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8824">https://www.rfc-editor.org/rfc/rfc8824</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9031">[RFC9031]</dt>
        <dd>
<span class="refAuthor">VuÄiniÄ, M., Ed.</span>, <span class="refAuthor">Simon, J.</span>, <span class="refAuthor">Pister, K.</span>, and <span class="refAuthor">M. Richardson</span>, <span class="refTitle">"Constrained Join Protocol (CoJP) for 6TiSCH"</span>, <span class="seriesInfo">RFC 9031</span>, <span class="seriesInfo">DOI 10.17487/RFC9031</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9031">https://www.rfc-editor.org/rfc/rfc9031</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9176">[RFC9176]</dt>
        <dd>
<span class="refAuthor">AmsÃ¼ss, C., Ed.</span>, <span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Koster, M.</span>, <span class="refAuthor">Bormann, C.</span>, and <span class="refAuthor">P. van der Stok</span>, <span class="refTitle">"Constrained RESTful Environments (CoRE) Resource Directory"</span>, <span class="seriesInfo">RFC 9176</span>, <span class="seriesInfo">DOI 10.17487/RFC9176</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9176">https://www.rfc-editor.org/rfc/rfc9176</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9200">https://www.rfc-editor.org/rfc/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9203">[RFC9203]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, and <span class="refAuthor">M. Gunnarsson</span>, <span class="refTitle">"The Object Security for Constrained RESTful Environments (OSCORE) Profile of the Authentication and Authorization for Constrained Environments (ACE) Framework"</span>, <span class="seriesInfo">RFC 9203</span>, <span class="seriesInfo">DOI 10.17487/RFC9203</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9203">https://www.rfc-editor.org/rfc/rfc9203</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Symmetric-Security">[Symmetric-Security]</dt>
      <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refTitle">"Security of Symmetric Ratchets and Key Chains - Implications for Protocols like TLS 1.3, Signal, and PQ3"</span>, <time datetime="2024-02" class="refDate">February 2024</time>, <span>&lt;<a href="https://eprint.iacr.org/2024/220">https://eprint.iacr.org/2024/220</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="ssec-derive-ctx-client-init-requests-only">
<section id="appendix-A">
      <h2 id="name-forward-message-flow-using-">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-forward-message-flow-using-" class="section-name selfRef">Forward Message Flow using two CoAP Requests</a>
      </h2>
<p id="appendix-A-1">This section presents an example of KUDOS run in the forward message flow, with the client acting as KUDOS initiator, and both KUDOS messages being CoAP requests.<a href="#appendix-A-1" class="pilcrow">Â¶</a></p>
<p id="appendix-A-2">The example uses the same notation 'Comb(a,b)' used in <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>.<a href="#appendix-A-2" class="pilcrow">Â¶</a></p>
<span id="name-example-of-the-kudos-forward"></span><div id="fig-message-exchange-client-init-requests-only">
<figure id="figure-7">
        <div id="appendix-A-3.1">
          <div class="alignCenter art-svg artwork" id="appendix-A-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1216" width="576" viewBox="0 0 576 1216" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 200,64 L 200,768" fill="none" stroke="black"></path>
              <path d="M 200,848 L 200,1200" fill="none" stroke="black"></path>
              <path d="M 384,64 L 384,768" fill="none" stroke="black"></path>
              <path d="M 384,848 L 384,1200" fill="none" stroke="black"></path>
              <path d="M 200,208 L 376,208" fill="none" stroke="black"></path>
              <path d="M 208,544 L 384,544" fill="none" stroke="black"></path>
              <path d="M 200,880 L 376,880" fill="none" stroke="black"></path>
              <path d="M 208,1056 L 384,1056" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="384,880 372,874.4 372,885.6" fill="black" transform="rotate(0,376,880)"></polygon>
              <polygon class="arrowhead" points="384,208 372,202.4 372,213.6" fill="black" transform="rotate(0,376,208)"></polygon>
              <polygon class="arrowhead" points="216,1056 204,1050.4 204,1061.6" fill="black" transform="rotate(180,208,1056)"></polygon>
              <polygon class="arrowhead" points="216,544 204,538.4 204,549.6" fill="black" transform="rotate(180,208,544)"></polygon>
              <g class="text">
                <text x="200" y="36">Client/Server</text>
                <text x="384" y="36">Client/Server</text>
                <text x="200" y="52">(initiator)</text>
                <text x="384" y="52">(responder)</text>
                <text x="36" y="84">Generate</text>
                <text x="84" y="84">N1</text>
                <text x="24" y="116">CTX_1</text>
                <text x="56" y="116">=</text>
                <text x="108" y="116">updateCtx(</text>
                <text x="80" y="132">X1,</text>
                <text x="80" y="148">N1,</text>
                <text x="96" y="164">CTX_OLD</text>
                <text x="136" y="164">)</text>
                <text x="280" y="196">Request</text>
                <text x="324" y="196">#1</text>
                <text x="32" y="212">Protect</text>
                <text x="84" y="212">with</text>
                <text x="128" y="212">CTX_1</text>
                <text x="468" y="212">/.well-known/kudos</text>
                <text x="236" y="228">Token:</text>
                <text x="284" y="228">0x4a</text>
                <text x="236" y="244">OSCORE</text>
                <text x="272" y="244">{</text>
                <text x="232" y="260">...</text>
                <text x="248" y="276">Partial</text>
                <text x="296" y="276">IV:</text>
                <text x="320" y="276">0</text>
                <text x="232" y="292">...</text>
                <text x="224" y="308">d</text>
                <text x="256" y="308">flag:</text>
                <text x="288" y="308">1</text>
                <text x="416" y="308">CTX_1</text>
                <text x="448" y="308">=</text>
                <text x="500" y="308">updateCtx(</text>
                <text x="228" y="324">x:</text>
                <text x="252" y="324">X1</text>
                <text x="472" y="324">X1,</text>
                <text x="244" y="340">nonce:</text>
                <text x="284" y="340">N1</text>
                <text x="472" y="340">N1,</text>
                <text x="232" y="356">...</text>
                <text x="488" y="356">CTX_OLD</text>
                <text x="528" y="356">)</text>
                <text x="216" y="372">}</text>
                <text x="248" y="388">Encrypted</text>
                <text x="320" y="388">Payload</text>
                <text x="360" y="388">{</text>
                <text x="420" y="388">Verify</text>
                <text x="468" y="388">with</text>
                <text x="512" y="388">CTX_1</text>
                <text x="232" y="404">...</text>
                <text x="216" y="420">}</text>
                <text x="428" y="420">Generate</text>
                <text x="476" y="420">N2</text>
                <text x="424" y="452">CTX_NEW</text>
                <text x="464" y="452">=</text>
                <text x="516" y="452">updateCtx(</text>
                <text x="524" y="468">Comb(X1,X2),</text>
                <text x="524" y="484">Comb(N1,N2),</text>
                <text x="504" y="500">CTX_OLD</text>
                <text x="544" y="500">)</text>
                <text x="280" y="532">Request</text>
                <text x="324" y="532">#2</text>
                <text x="116" y="548">/.well-known/kudos</text>
                <text x="424" y="548">Protect</text>
                <text x="476" y="548">with</text>
                <text x="528" y="548">CTX_NEW</text>
                <text x="236" y="564">Token:</text>
                <text x="284" y="564">0x7c</text>
                <text x="236" y="580">OSCORE</text>
                <text x="272" y="580">{</text>
                <text x="232" y="596">...</text>
                <text x="32" y="612">CTX_NEW</text>
                <text x="72" y="612">=</text>
                <text x="124" y="612">updateCtx(</text>
                <text x="248" y="612">Partial</text>
                <text x="296" y="612">IV:</text>
                <text x="320" y="612">0</text>
                <text x="132" y="628">Comb(X1,X2),</text>
                <text x="232" y="628">...</text>
                <text x="132" y="644">Comb(N1,N2),</text>
                <text x="224" y="644">d</text>
                <text x="256" y="644">flag:</text>
                <text x="288" y="644">1</text>
                <text x="112" y="660">CTX_OLD</text>
                <text x="152" y="660">)</text>
                <text x="228" y="660">x:</text>
                <text x="252" y="660">X2</text>
                <text x="244" y="676">nonce:</text>
                <text x="284" y="676">N2</text>
                <text x="28" y="692">Verify</text>
                <text x="76" y="692">with</text>
                <text x="128" y="692">CTX_NEW</text>
                <text x="232" y="692">...</text>
                <text x="216" y="708">}</text>
                <text x="32" y="724">Discard</text>
                <text x="96" y="724">CTX_OLD</text>
                <text x="248" y="724">Encrypted</text>
                <text x="320" y="724">Payload</text>
                <text x="360" y="724">{</text>
                <text x="232" y="740">...</text>
                <text x="216" y="756">}</text>
                <text x="16" y="804">The</text>
                <text x="60" y="804">actual</text>
                <text x="104" y="804">key</text>
                <text x="148" y="804">update</text>
                <text x="208" y="804">process</text>
                <text x="260" y="804">ends</text>
                <text x="304" y="804">here.</text>
                <text x="16" y="820">The</text>
                <text x="48" y="820">two</text>
                <text x="88" y="820">peers</text>
                <text x="128" y="820">can</text>
                <text x="160" y="820">use</text>
                <text x="192" y="820">the</text>
                <text x="224" y="820">new</text>
                <text x="276" y="820">Security</text>
                <text x="344" y="820">Context</text>
                <text x="412" y="820">CTX_NEW.</text>
                <text x="284" y="868">Response</text>
                <text x="332" y="868">#1</text>
                <text x="32" y="884">Protect</text>
                <text x="84" y="884">with</text>
                <text x="136" y="884">CTX_NEW</text>
                <text x="236" y="900">Token:</text>
                <text x="284" y="900">0x7c</text>
                <text x="236" y="916">OSCORE</text>
                <text x="272" y="916">{</text>
                <text x="232" y="932">...</text>
                <text x="216" y="948">}</text>
                <text x="420" y="948">Verify</text>
                <text x="468" y="948">with</text>
                <text x="520" y="948">CTX_NEW</text>
                <text x="248" y="964">Encrypted</text>
                <text x="320" y="964">Payload</text>
                <text x="360" y="964">{</text>
                <text x="232" y="980">...</text>
                <text x="424" y="980">Discard</text>
                <text x="488" y="980">CTX_OLD</text>
                <text x="264" y="996">Application</text>
                <text x="344" y="996">Payload</text>
                <text x="216" y="1012">}</text>
                <text x="284" y="1044">Response</text>
                <text x="332" y="1044">#2</text>
                <text x="424" y="1060">Protect</text>
                <text x="476" y="1060">with</text>
                <text x="528" y="1060">CTX_NEW</text>
                <text x="236" y="1076">Token:</text>
                <text x="284" y="1076">0x4a</text>
                <text x="236" y="1092">OSCORE</text>
                <text x="272" y="1092">{</text>
                <text x="232" y="1108">...</text>
                <text x="28" y="1124">Verify</text>
                <text x="76" y="1124">with</text>
                <text x="128" y="1124">CTX_NEW</text>
                <text x="216" y="1124">}</text>
                <text x="248" y="1140">Encrypted</text>
                <text x="320" y="1140">Payload</text>
                <text x="360" y="1140">{</text>
                <text x="232" y="1156">...</text>
                <text x="264" y="1172">Application</text>
                <text x="344" y="1172">Payload</text>
                <text x="216" y="1188">}</text>
              </g>
            </svg><a href="#appendix-A-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-of-the-kudos-forward" class="selfRef">Example of the KUDOS forward message flow where both KUDOS messages are requests.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-derive-ctx-client-init-unrelated">
<section id="appendix-B">
      <h2 id="name-forward-message-flow-with-r">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-forward-message-flow-with-r" class="section-name selfRef">Forward Message Flow with Response #1 unrelated to Request #1</a>
      </h2>
<p id="appendix-B-1">This section presents an example of KUDOS run in the forward message flow, with the client acting as KUDOS initiator, and where the second KUDOS message Response #1 is not a response to the first KUDOS message Request #2, but rather an unrelated Observe notification as a response to the non-KUDOS message Request #1<a href="#appendix-B-1" class="pilcrow">Â¶</a></p>
<p id="appendix-B-2">The example uses the same notation 'Comb(a,b)' used in <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>.<a href="#appendix-B-2" class="pilcrow">Â¶</a></p>
<span id="name-example-of-the-kudos-forward-"></span><div id="fig-message-exchange-client-init-unrelated-response">
<figure id="figure-8">
        <div id="appendix-B-3.1">
          <div class="alignCenter art-svg artwork" id="appendix-B-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1312" width="576" viewBox="0 0 576 1312" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 200,64 L 200,1056" fill="none" stroke="black"></path>
              <path d="M 200,1136 L 200,1296" fill="none" stroke="black"></path>
              <path d="M 384,64 L 384,1056" fill="none" stroke="black"></path>
              <path d="M 384,1136 L 384,1296" fill="none" stroke="black"></path>
              <path d="M 200,112 L 376,112" fill="none" stroke="black"></path>
              <path d="M 200,448 L 376,448" fill="none" stroke="black"></path>
              <path d="M 208,800 L 384,800" fill="none" stroke="black"></path>
              <path d="M 208,1152 L 384,1152" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="384,448 372,442.4 372,453.6" fill="black" transform="rotate(0,376,448)"></polygon>
              <polygon class="arrowhead" points="384,112 372,106.4 372,117.6" fill="black" transform="rotate(0,376,112)"></polygon>
              <polygon class="arrowhead" points="216,1152 204,1146.4 204,1157.6" fill="black" transform="rotate(180,208,1152)"></polygon>
              <polygon class="arrowhead" points="216,800 204,794.4 204,805.6" fill="black" transform="rotate(180,208,800)"></polygon>
              <g class="text">
                <text x="196" y="36">Client</text>
                <text x="388" y="36">Server</text>
                <text x="200" y="52">(initiator)</text>
                <text x="384" y="52">(responder)</text>
                <text x="280" y="84">Request</text>
                <text x="324" y="84">#1</text>
                <text x="292" y="100">(Registration)</text>
                <text x="32" y="116">Protect</text>
                <text x="84" y="116">with</text>
                <text x="136" y="116">CTX_OLD</text>
                <text x="412" y="116">/obs</text>
                <text x="236" y="132">Token:</text>
                <text x="284" y="132">0x4a</text>
                <text x="244" y="148">Observe:</text>
                <text x="288" y="148">0</text>
                <text x="236" y="164">OSCORE</text>
                <text x="272" y="164">{</text>
                <text x="232" y="180">...</text>
                <text x="248" y="196">Partial</text>
                <text x="296" y="196">IV:</text>
                <text x="332" y="196">4324</text>
                <text x="232" y="212">...</text>
                <text x="216" y="228">}</text>
                <text x="248" y="244">Encrypted</text>
                <text x="320" y="244">Payload</text>
                <text x="360" y="244">{</text>
                <text x="420" y="244">Verify</text>
                <text x="468" y="244">with</text>
                <text x="520" y="244">CTX_OLD</text>
                <text x="252" y="260">Observe:</text>
                <text x="296" y="260">-</text>
                <text x="232" y="276">...</text>
                <text x="216" y="292">}</text>
                <text x="36" y="324">Generate</text>
                <text x="84" y="324">N1</text>
                <text x="24" y="356">CTX_1</text>
                <text x="56" y="356">=</text>
                <text x="108" y="356">updateCtx(</text>
                <text x="80" y="372">X1,</text>
                <text x="80" y="388">N1,</text>
                <text x="96" y="404">CTX_OLD</text>
                <text x="136" y="404">)</text>
                <text x="280" y="436">Request</text>
                <text x="324" y="436">#2</text>
                <text x="32" y="452">Protect</text>
                <text x="84" y="452">with</text>
                <text x="128" y="452">CTX_1</text>
                <text x="468" y="452">/.well-known/kudos</text>
                <text x="236" y="468">Token:</text>
                <text x="284" y="468">0x7c</text>
                <text x="236" y="484">OSCORE</text>
                <text x="272" y="484">{</text>
                <text x="232" y="500">...</text>
                <text x="248" y="516">Partial</text>
                <text x="296" y="516">IV:</text>
                <text x="320" y="516">0</text>
                <text x="232" y="532">...</text>
                <text x="224" y="548">d</text>
                <text x="256" y="548">flag:</text>
                <text x="288" y="548">1</text>
                <text x="416" y="548">CTX_1</text>
                <text x="448" y="548">=</text>
                <text x="500" y="548">updateCtx(</text>
                <text x="228" y="564">x:</text>
                <text x="252" y="564">X1</text>
                <text x="472" y="564">X1,</text>
                <text x="244" y="580">nonce:</text>
                <text x="284" y="580">N1</text>
                <text x="472" y="580">N1,</text>
                <text x="232" y="596">...</text>
                <text x="488" y="596">CTX_OLD</text>
                <text x="528" y="596">)</text>
                <text x="216" y="612">}</text>
                <text x="248" y="628">Encrypted</text>
                <text x="320" y="628">Payload</text>
                <text x="360" y="628">{</text>
                <text x="420" y="628">Verify</text>
                <text x="468" y="628">with</text>
                <text x="512" y="628">CTX_1</text>
                <text x="232" y="644">...</text>
                <text x="216" y="660">}</text>
                <text x="428" y="660">Generate</text>
                <text x="476" y="660">N2</text>
                <text x="424" y="692">CTX_NEW</text>
                <text x="464" y="692">=</text>
                <text x="516" y="692">updateCtx(</text>
                <text x="524" y="708">Comb(X1,X2),</text>
                <text x="524" y="724">Comb(N1,N2),</text>
                <text x="504" y="740">CTX_OLD</text>
                <text x="544" y="740">)</text>
                <text x="284" y="772">Response</text>
                <text x="332" y="772">#1</text>
                <text x="292" y="788">(Notification)</text>
                <text x="424" y="804">Protect</text>
                <text x="476" y="804">with</text>
                <text x="528" y="804">CTX_NEW</text>
                <text x="236" y="820">Token:</text>
                <text x="284" y="820">0x4a</text>
                <text x="244" y="836">Observe:</text>
                <text x="288" y="836">1</text>
                <text x="236" y="852">OSCORE</text>
                <text x="272" y="852">{</text>
                <text x="232" y="868">...</text>
                <text x="32" y="884">CTX_NEW</text>
                <text x="72" y="884">=</text>
                <text x="124" y="884">updateCtx(</text>
                <text x="248" y="884">Partial</text>
                <text x="296" y="884">IV:</text>
                <text x="320" y="884">0</text>
                <text x="132" y="900">Comb(X1,X2),</text>
                <text x="232" y="900">...</text>
                <text x="132" y="916">Comb(N1,N2),</text>
                <text x="224" y="916">d</text>
                <text x="256" y="916">flag:</text>
                <text x="288" y="916">1</text>
                <text x="112" y="932">CTX_OLD</text>
                <text x="152" y="932">)</text>
                <text x="228" y="932">x:</text>
                <text x="252" y="932">X2</text>
                <text x="244" y="948">nonce:</text>
                <text x="284" y="948">N2</text>
                <text x="28" y="964">Verify</text>
                <text x="76" y="964">with</text>
                <text x="128" y="964">CTX_NEW</text>
                <text x="232" y="964">...</text>
                <text x="216" y="980">}</text>
                <text x="32" y="996">Discard</text>
                <text x="96" y="996">CTX_OLD</text>
                <text x="248" y="996">Encrypted</text>
                <text x="320" y="996">Payload</text>
                <text x="360" y="996">{</text>
                <text x="244" y="1012">Observe:</text>
                <text x="288" y="1012">-</text>
                <text x="232" y="1028">...</text>
                <text x="216" y="1044">}</text>
                <text x="16" y="1092">The</text>
                <text x="60" y="1092">actual</text>
                <text x="104" y="1092">key</text>
                <text x="148" y="1092">update</text>
                <text x="208" y="1092">process</text>
                <text x="260" y="1092">ends</text>
                <text x="304" y="1092">here.</text>
                <text x="16" y="1108">The</text>
                <text x="48" y="1108">two</text>
                <text x="88" y="1108">peers</text>
                <text x="128" y="1108">can</text>
                <text x="160" y="1108">use</text>
                <text x="192" y="1108">the</text>
                <text x="224" y="1108">new</text>
                <text x="276" y="1108">Security</text>
                <text x="344" y="1108">Context</text>
                <text x="412" y="1108">CTX_NEW.</text>
                <text x="284" y="1140">Response</text>
                <text x="332" y="1140">#2</text>
                <text x="424" y="1156">Protect</text>
                <text x="476" y="1156">with</text>
                <text x="528" y="1156">CTX_NEW</text>
                <text x="236" y="1172">Token:</text>
                <text x="284" y="1172">0x7c</text>
                <text x="236" y="1188">OSCORE</text>
                <text x="272" y="1188">{</text>
                <text x="232" y="1204">...</text>
                <text x="28" y="1220">Verify</text>
                <text x="76" y="1220">with</text>
                <text x="128" y="1220">CTX_NEW</text>
                <text x="216" y="1220">}</text>
                <text x="248" y="1236">Encrypted</text>
                <text x="320" y="1236">Payload</text>
                <text x="360" y="1236">{</text>
                <text x="232" y="1252">...</text>
                <text x="264" y="1268">Application</text>
                <text x="344" y="1268">Payload</text>
                <text x="216" y="1284">}</text>
              </g>
            </svg><a href="#appendix-B-3.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-example-of-the-kudos-forward-" class="selfRef">Example of the KUDOS forward message flow where the second KUDOS message Response #1 is not a response to Request #1.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-derive-ctx-client-init-normal-resource">
<section id="appendix-C">
      <h2 id="name-forward-message-flow-target">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-forward-message-flow-target" class="section-name selfRef">Forward Message Flow Targeting a non-KUDOS Resource at Server</a>
      </h2>
<p id="appendix-C-1">This section presents an example of KUDOS run in the forward message flow, with the client acting as KUDOS initiator, and with the KUDOS message Request #1 targeting a non-KUDOS resource at the Uri-Path "/temp". The server application has freshness requirements on the requests targeting the resource at "/temp".<a href="#appendix-C-1" class="pilcrow">Â¶</a></p>
<p id="appendix-C-2">Note the presence of an application payload in the KUDOS message Request #1 and in the non-KUDOS message Request #2, both of which are composed as PUT requests. That request method is part of the encrypted payload, since it is protected by OSCORE.<a href="#appendix-C-2" class="pilcrow">Â¶</a></p>
<p id="appendix-C-3">Also note the fact that the KUDOS message Response #1 is composed as a 4.01 (Unauthorized) response, while the non-KUDOS message Response #2 is composed as a 2.04 (Changed) repsonse. Those response codes are part of the encrypted payload, since they are protected by OSCORE.<a href="#appendix-C-3" class="pilcrow">Â¶</a></p>
<p id="appendix-C-4">The example uses the same notation 'Comb(a,b)' used in <a href="#ssec-derive-ctx-client-init" class="auto internal xref">Section 4.3.4</a>.<a href="#appendix-C-4" class="pilcrow">Â¶</a></p>
<span id="name-example-of-the-kudos-forward-m"></span><div id="fig-message-exchange-client-init-normal-resource">
<figure id="figure-9">
        <div id="appendix-C-5.1">
          <div class="alignCenter art-svg artwork" id="appendix-C-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="1248" width="576" viewBox="0 0 576 1248" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 200,64 L 200,800" fill="none" stroke="black"></path>
              <path d="M 200,880 L 200,1232" fill="none" stroke="black"></path>
              <path d="M 384,64 L 384,800" fill="none" stroke="black"></path>
              <path d="M 384,880 L 384,1232" fill="none" stroke="black"></path>
              <path d="M 200,208 L 376,208" fill="none" stroke="black"></path>
              <path d="M 208,560 L 384,560" fill="none" stroke="black"></path>
              <path d="M 200,912 L 376,912" fill="none" stroke="black"></path>
              <path d="M 208,1088 L 384,1088" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="384,912 372,906.4 372,917.6" fill="black" transform="rotate(0,376,912)"></polygon>
              <polygon class="arrowhead" points="384,208 372,202.4 372,213.6" fill="black" transform="rotate(0,376,208)"></polygon>
              <polygon class="arrowhead" points="216,1088 204,1082.4 204,1093.6" fill="black" transform="rotate(180,208,1088)"></polygon>
              <polygon class="arrowhead" points="216,560 204,554.4 204,565.6" fill="black" transform="rotate(180,208,560)"></polygon>
              <g class="text">
                <text x="196" y="36">Client</text>
                <text x="388" y="36">Server</text>
                <text x="200" y="52">(initiator)</text>
                <text x="384" y="52">(responder)</text>
                <text x="36" y="84">Generate</text>
                <text x="84" y="84">N1</text>
                <text x="24" y="116">CTX_1</text>
                <text x="56" y="116">=</text>
                <text x="108" y="116">updateCtx(</text>
                <text x="80" y="132">X1,</text>
                <text x="80" y="148">N1,</text>
                <text x="96" y="164">CTX_OLD</text>
                <text x="136" y="164">)</text>
                <text x="280" y="196">Request</text>
                <text x="324" y="196">#1</text>
                <text x="32" y="212">Protect</text>
                <text x="84" y="212">with</text>
                <text x="128" y="212">CTX_1</text>
                <text x="416" y="212">/temp</text>
                <text x="236" y="228">OSCORE</text>
                <text x="272" y="228">{</text>
                <text x="232" y="244">...</text>
                <text x="248" y="260">Partial</text>
                <text x="296" y="260">IV:</text>
                <text x="320" y="260">0</text>
                <text x="232" y="276">...</text>
                <text x="224" y="292">d</text>
                <text x="256" y="292">flag:</text>
                <text x="288" y="292">1</text>
                <text x="416" y="292">CTX_1</text>
                <text x="448" y="292">=</text>
                <text x="500" y="292">updateCtx(</text>
                <text x="228" y="308">x:</text>
                <text x="252" y="308">X1</text>
                <text x="472" y="308">X1,</text>
                <text x="244" y="324">nonce:</text>
                <text x="284" y="324">N1</text>
                <text x="472" y="324">N1,</text>
                <text x="232" y="340">...</text>
                <text x="488" y="340">CTX_OLD</text>
                <text x="528" y="340">)</text>
                <text x="216" y="356">}</text>
                <text x="248" y="372">Encrypted</text>
                <text x="320" y="372">Payload</text>
                <text x="360" y="372">{</text>
                <text x="420" y="372">Verify</text>
                <text x="468" y="372">with</text>
                <text x="512" y="372">CTX_1</text>
                <text x="236" y="388">0.03</text>
                <text x="280" y="388">(PUT)</text>
                <text x="232" y="404">...</text>
                <text x="264" y="420">Application</text>
                <text x="344" y="420">Payload</text>
                <text x="216" y="436">}</text>
                <text x="428" y="436">Generate</text>
                <text x="476" y="436">N2</text>
                <text x="424" y="468">CTX_NEW</text>
                <text x="464" y="468">=</text>
                <text x="516" y="468">updateCtx(</text>
                <text x="524" y="484">Comb(X1,X2),</text>
                <text x="524" y="500">Comb(N1,N2),</text>
                <text x="504" y="516">CTX_OLD</text>
                <text x="544" y="516">)</text>
                <text x="284" y="548">Response</text>
                <text x="332" y="548">#1</text>
                <text x="424" y="564">Protect</text>
                <text x="476" y="564">with</text>
                <text x="528" y="564">CTX_NEW</text>
                <text x="236" y="580">OSCORE</text>
                <text x="272" y="580">{</text>
                <text x="232" y="596">...</text>
                <text x="32" y="612">CTX_NEW</text>
                <text x="72" y="612">=</text>
                <text x="124" y="612">updateCtx(</text>
                <text x="248" y="612">Partial</text>
                <text x="296" y="612">IV:</text>
                <text x="320" y="612">0</text>
                <text x="132" y="628">Comb(X1,X2),</text>
                <text x="232" y="628">...</text>
                <text x="132" y="644">Comb(N1,N2),</text>
                <text x="224" y="644">d</text>
                <text x="256" y="644">flag:</text>
                <text x="288" y="644">1</text>
                <text x="112" y="660">CTX_OLD</text>
                <text x="152" y="660">)</text>
                <text x="228" y="660">x:</text>
                <text x="252" y="660">X2</text>
                <text x="244" y="676">nonce:</text>
                <text x="284" y="676">N2</text>
                <text x="28" y="692">Verify</text>
                <text x="76" y="692">with</text>
                <text x="128" y="692">CTX_NEW</text>
                <text x="232" y="692">...</text>
                <text x="216" y="708">}</text>
                <text x="32" y="724">Discard</text>
                <text x="96" y="724">CTX_OLD</text>
                <text x="248" y="724">Encrypted</text>
                <text x="320" y="724">Payload</text>
                <text x="360" y="724">{</text>
                <text x="236" y="740">4.01</text>
                <text x="316" y="740">(Unauthorized)</text>
                <text x="232" y="756">...</text>
                <text x="264" y="772">Application</text>
                <text x="344" y="772">Payload</text>
                <text x="216" y="788">}</text>
                <text x="16" y="836">The</text>
                <text x="60" y="836">actual</text>
                <text x="104" y="836">key</text>
                <text x="148" y="836">update</text>
                <text x="208" y="836">process</text>
                <text x="260" y="836">ends</text>
                <text x="304" y="836">here.</text>
                <text x="16" y="852">The</text>
                <text x="48" y="852">two</text>
                <text x="88" y="852">peers</text>
                <text x="128" y="852">can</text>
                <text x="160" y="852">use</text>
                <text x="192" y="852">the</text>
                <text x="224" y="852">new</text>
                <text x="276" y="852">Security</text>
                <text x="344" y="852">Context</text>
                <text x="412" y="852">CTX_NEW.</text>
                <text x="280" y="900">Request</text>
                <text x="324" y="900">#2</text>
                <text x="32" y="916">Protect</text>
                <text x="84" y="916">with</text>
                <text x="136" y="916">CTX_NEW</text>
                <text x="416" y="916">/temp</text>
                <text x="236" y="932">OSCORE</text>
                <text x="272" y="932">{</text>
                <text x="232" y="948">...</text>
                <text x="216" y="964">}</text>
                <text x="420" y="964">Verify</text>
                <text x="468" y="964">with</text>
                <text x="520" y="964">CTX_NEW</text>
                <text x="248" y="980">Encrypted</text>
                <text x="320" y="980">Payload</text>
                <text x="360" y="980">{</text>
                <text x="236" y="996">0.03</text>
                <text x="280" y="996">(PUT)</text>
                <text x="232" y="1012">...</text>
                <text x="424" y="1012">Discard</text>
                <text x="488" y="1012">CTX_OLD</text>
                <text x="264" y="1028">Application</text>
                <text x="344" y="1028">Payload</text>
                <text x="216" y="1044">}</text>
                <text x="284" y="1076">Response</text>
                <text x="332" y="1076">#2</text>
                <text x="424" y="1092">Protect</text>
                <text x="476" y="1092">with</text>
                <text x="528" y="1092">CTX_NEW</text>
                <text x="236" y="1108">OSCORE</text>
                <text x="272" y="1108">{</text>
                <text x="232" y="1124">...</text>
                <text x="28" y="1140">Verify</text>
                <text x="76" y="1140">with</text>
                <text x="128" y="1140">CTX_NEW</text>
                <text x="216" y="1140">}</text>
                <text x="248" y="1156">Encrypted</text>
                <text x="320" y="1156">Payload</text>
                <text x="360" y="1156">{</text>
                <text x="236" y="1172">2.04</text>
                <text x="296" y="1172">(Changed)</text>
                <text x="232" y="1188">...</text>
                <text x="264" y="1204">Application</text>
                <text x="344" y="1204">Payload</text>
                <text x="216" y="1220">}</text>
              </g>
            </svg><a href="#appendix-C-5.1.1" class="pilcrow">Â¶</a>
</div>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-example-of-the-kudos-forward-m" class="selfRef">Example of the KUDOS forward message flow where the KUDOS message Request #1 targets a non-KUDOS resource.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-D">
      <h2 id="name-document-updates">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-D-1">This section is to be removed before publishing as an RFC.<a href="#appendix-D-1" class="pilcrow">Â¶</a></p>
<div id="sec-08-09">
<section id="appendix-D.1">
        <h3 id="name-version-08-to-09">
<a href="#appendix-D.1" class="section-number selfRef">D.1. </a><a href="#name-version-08-to-09" class="section-name selfRef">Version -08 to -09</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.1-1.1">
            <p id="appendix-D.1-1.1.1">Editorial improvements and clarifications.<a href="#appendix-D.1-1.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-07-08">
<section id="appendix-D.2">
        <h3 id="name-version-07-to-08">
<a href="#appendix-D.2" class="section-number selfRef">D.2. </a><a href="#name-version-07-to-08" class="section-name selfRef">Version -07 to -08</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.2-1.1">
            <p id="appendix-D.2-1.1.1">Add note about usage of the CoAP No-Response Option.<a href="#appendix-D.2-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.2">
            <p id="appendix-D.2-1.2.1">Avoid problems for two simultaneously started key updates.<a href="#appendix-D.2-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.3">
            <p id="appendix-D.2-1.3.1">Set Notification Number to be uninitialized for new OSCORE Security Contexts.<a href="#appendix-D.2-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.4">
            <p id="appendix-D.2-1.4.1">Handle corner case for responder that reached its key usage limits.<a href="#appendix-D.2-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.5">
            <p id="appendix-D.2-1.5.1">Re-organizing main section about Forward Secrecy mode into subsections.<a href="#appendix-D.2-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.6">
            <p id="appendix-D.2-1.6.1">IANA considerations for CoAP Option Numbers Registry to refer to this draft for the OSCORE option.<a href="#appendix-D.2-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.7">
            <p id="appendix-D.2-1.7.1">Use AASVG in diagrams.<a href="#appendix-D.2-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.8">
            <p id="appendix-D.2-1.8.1">Use actual tables instead of figures.<a href="#appendix-D.2-1.8.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.9">
            <p id="appendix-D.2-1.9.1">Clarifications and editorial improvements.<a href="#appendix-D.2-1.9.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.10">
            <p id="appendix-D.2-1.10.1">Extended security considerations with reference to relevant paper.<a href="#appendix-D.2-1.10.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-06-07">
<section id="appendix-D.3">
        <h3 id="name-version-06-to-07">
<a href="#appendix-D.3" class="section-number selfRef">D.3. </a><a href="#name-version-06-to-07" class="section-name selfRef">Version -06 to -07</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.3-1.1">
            <p id="appendix-D.3-1.1.1">Removed material about the ID update procedure, which has been split out into a separate draft.<a href="#appendix-D.3-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.2">
            <p id="appendix-D.3-1.2.1">Allow non-random nonces for CAPABLE devices.<a href="#appendix-D.3-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.3">
            <p id="appendix-D.3-1.3.1">Editorial improvements.<a href="#appendix-D.3-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.4">
            <p id="appendix-D.3-1.4.1">Permit flexible message flow with KUDOS messages as any request/response.<a href="#appendix-D.3-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.3-1.5">
            <p id="appendix-D.3-1.5.1">Enable sending KUDOS messages as regular application messages.<a href="#appendix-D.3-1.5.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-05-06">
<section id="appendix-D.4">
        <h3 id="name-version-05-to-06">
<a href="#appendix-D.4" class="section-number selfRef">D.4. </a><a href="#name-version-05-to-06" class="section-name selfRef">Version -05 to -06</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.4-1.1">
            <p id="appendix-D.4-1.1.1">Mandate support for both the forward and reverse message flow.<a href="#appendix-D.4-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.2">
            <p id="appendix-D.4-1.2.1">Mention the EDHOC and OSCORE profile of ACE as method for rekeying.<a href="#appendix-D.4-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.3">
            <p id="appendix-D.4-1.3.1">Clarify definition of KUDOS (request/response) message.<a href="#appendix-D.4-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.4">
            <p id="appendix-D.4-1.4.1">Further extend the OSCORE option to transport N1 in the second KUDOS message as a request.<a href="#appendix-D.4-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.5">
            <p id="appendix-D.4-1.5.1">Mandate support for the no-FS mode on CAPABLE devices.<a href="#appendix-D.4-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.6">
            <p id="appendix-D.4-1.6.1">Explain when KUDOS fails during selection of mode.<a href="#appendix-D.4-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.7">
            <p id="appendix-D.4-1.7.1">Explicitly forbid using old keying material after reboot.<a href="#appendix-D.4-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.8">
            <p id="appendix-D.4-1.8.1">Editorial improvements.<a href="#appendix-D.4-1.8.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-04-05">
<section id="appendix-D.5">
        <h3 id="name-version-04-to-05">
<a href="#appendix-D.5" class="section-number selfRef">D.5. </a><a href="#name-version-04-to-05" class="section-name selfRef">Version -04 to -05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.5-1.1">
            <p id="appendix-D.5-1.1.1">Note on client retransmissions if KUDOS execution fails in reverse message flow.<a href="#appendix-D.5-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.2">
            <p id="appendix-D.5-1.2.1">Specify what information needs to be written to non-volatile memory to handle reboots.<a href="#appendix-D.5-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.3">
            <p id="appendix-D.5-1.3.1">Extended recommendations and considerations on minimum size of nonces N1 &amp; N2.<a href="#appendix-D.5-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.4">
            <p id="appendix-D.5-1.4.1">Arbitrary maximum size of the Recipient-ID Option.<a href="#appendix-D.5-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.5">
            <p id="appendix-D.5-1.5.1">Detailed lifecycle of the OSCORE IDs update procedure.<a href="#appendix-D.5-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.6">
            <p id="appendix-D.5-1.6.1">Described examples of OSCORE IDs update procedure.<a href="#appendix-D.5-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.7">
            <p id="appendix-D.5-1.7.1">Examples of OSCORE IDs update procedure integrated in KUDOS.<a href="#appendix-D.5-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.8">
            <p id="appendix-D.5-1.8.1">Considerations about using SCHC for CoAP with OSCORE.<a href="#appendix-D.5-1.8.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.9">
            <p id="appendix-D.5-1.9.1">Clarifications and editorial improvements.<a href="#appendix-D.5-1.9.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-03-04">
<section id="appendix-D.6">
        <h3 id="name-version-03-to-04">
<a href="#appendix-D.6" class="section-number selfRef">D.6. </a><a href="#name-version-03-to-04" class="section-name selfRef">Version -03 to -04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.6-1.1">
            <p id="appendix-D.6-1.1.1">Removed content about key usage limits.<a href="#appendix-D.6-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.2">
            <p id="appendix-D.6-1.2.1">Use of "forward message flow" and "reverse message flow".<a href="#appendix-D.6-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.3">
            <p id="appendix-D.6-1.3.1">Update to RFC 8613 extended to include protection of responses.<a href="#appendix-D.6-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.4">
            <p id="appendix-D.6-1.4.1">Include EDHOC_KeyUpdate() in the methods for rekeying.<a href="#appendix-D.6-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.5">
            <p id="appendix-D.6-1.5.1">Describe reasons for using the OSCORE ID update procedure.<a href="#appendix-D.6-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.6">
            <p id="appendix-D.6-1.6.1">Clarifications on deletion of CTX_OLD and CTX_NEW.<a href="#appendix-D.6-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.7">
            <p id="appendix-D.6-1.7.1">Added new section on preventing deadlocks.<a href="#appendix-D.6-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.8">
            <p id="appendix-D.6-1.8.1">Clarified that peers can decide to run KUDOS at any point.<a href="#appendix-D.6-1.8.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.9">
            <p id="appendix-D.6-1.9.1">Defined preservation of observations beyond OSCORE ID updates.<a href="#appendix-D.6-1.9.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.10">
            <p id="appendix-D.6-1.10.1">Revised discussion section, including also communication overhead.<a href="#appendix-D.6-1.10.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.11">
            <p id="appendix-D.6-1.11.1">Defined a well-known KUDOS resource and a KUDOS resource type.<a href="#appendix-D.6-1.11.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.12">
            <p id="appendix-D.6-1.12.1">Editorial improvements.<a href="#appendix-D.6-1.12.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-02-03">
<section id="appendix-D.7">
        <h3 id="name-version-02-to-03">
<a href="#appendix-D.7" class="section-number selfRef">D.7. </a><a href="#name-version-02-to-03" class="section-name selfRef">Version -02 to -03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.7-1.1">
            <p id="appendix-D.7-1.1.1">Use of the OSCORE flag bit 0 to signal more flag bits.<a href="#appendix-D.7-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.2">
            <p id="appendix-D.7-1.2.1">In UpdateCtx(), open for future key derivation different than HKDF.<a href="#appendix-D.7-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.3">
            <p id="appendix-D.7-1.3.1">Simplified updateCtx() to use only Expand(); used to be METHOD 2.<a href="#appendix-D.7-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.4">
            <p id="appendix-D.7-1.4.1">Included the Partial IV if the second KUDOS message is a response.<a href="#appendix-D.7-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.5">
            <p id="appendix-D.7-1.5.1">Added signaling of support for KUDOS in EDHOC.<a href="#appendix-D.7-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.6">
            <p id="appendix-D.7-1.6.1">Clarifications on terminology and reasons for rekeying.<a href="#appendix-D.7-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.7">
            <p id="appendix-D.7-1.7.1">Updated IANA considerations.<a href="#appendix-D.7-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.8">
            <p id="appendix-D.7-1.8.1">Editorial improvements.<a href="#appendix-D.7-1.8.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-01-02">
<section id="appendix-D.8">
        <h3 id="name-version-01-to-02">
<a href="#appendix-D.8" class="section-number selfRef">D.8. </a><a href="#name-version-01-to-02" class="section-name selfRef">Version -01 to -02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.8-1.1">
            <p id="appendix-D.8-1.1.1">Extended terminology.<a href="#appendix-D.8-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.2">
            <p id="appendix-D.8-1.2.1">Moved procedure for preserving observations across key updates to main body.<a href="#appendix-D.8-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.3">
            <p id="appendix-D.8-1.3.1">Moved procedure to update OSCORE Sender/Recipient IDs to main body.<a href="#appendix-D.8-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.4">
            <p id="appendix-D.8-1.4.1">Moved key update without forward secrecy section to main body.<a href="#appendix-D.8-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.5">
            <p id="appendix-D.8-1.5.1">Define signaling bits present in the 'x' byte.<a href="#appendix-D.8-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.6">
            <p id="appendix-D.8-1.6.1">Modifications and alignment of updateCtx() with EDHOC.<a href="#appendix-D.8-1.6.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.7">
            <p id="appendix-D.8-1.7.1">Rules for deletion of old EDHOC keys PRK_out and PRK_exporter.<a href="#appendix-D.8-1.7.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.8">
            <p id="appendix-D.8-1.8.1">Describe CBOR wrapping of involved nonces with examples.<a href="#appendix-D.8-1.8.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.9">
            <p id="appendix-D.8-1.9.1">Renamed 'id detail' to 'nonce'.<a href="#appendix-D.8-1.9.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.10">
            <p id="appendix-D.8-1.10.1">Editorial improvements.<a href="#appendix-D.8-1.10.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="sec-00-01">
<section id="appendix-D.9">
        <h3 id="name-version-00-to-01">
<a href="#appendix-D.9" class="section-number selfRef">D.9. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.9-1.1">
            <p id="appendix-D.9-1.1.1">Recommendation on limits for CCM_8. Details in Appendix.<a href="#appendix-D.9-1.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.2">
            <p id="appendix-D.9-1.2.1">Improved message processing, also covering corner cases.<a href="#appendix-D.9-1.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.3">
            <p id="appendix-D.9-1.3.1">Example of method to estimate and not store 'count_q'.<a href="#appendix-D.9-1.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.4">
            <p id="appendix-D.9-1.4.1">Added procedure to update OSCORE Sender/Recipient IDs.<a href="#appendix-D.9-1.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.5">
            <p id="appendix-D.9-1.5.1">Added method for preserving observations across key updates.<a href="#appendix-D.9-1.5.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.6">
            <p id="appendix-D.9-1.6.1">Added key update without forward secrecy.<a href="#appendix-D.9-1.6.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-E">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-E-1">The authors sincerely thank <span class="contact-name">Christian AmsÃ¼ss</span>, <span class="contact-name">Carsten Bormann</span>, <span class="contact-name">Simon Bouget</span>, <span class="contact-name">Rafa Marin-Lopez</span>, <span class="contact-name">John PreuÃ Mattsson</span>, and <span class="contact-name">GÃ¶ran Selander</span> for their feedback and comments.<a href="#appendix-E-1" class="pilcrow">Â¶</a></p>
<p id="appendix-E-2">The work on this document has been partly supported by the Sweden's Innovation Agency VINNOVA and the Celtic-Next projects CRITISEC and CYPRESS; and by the H2020 projects SIFIS-Home (Grant agreement 952652) and ARCADIAN-IoT (Grant agreement 101020259).<a href="#appendix-E-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-F">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rikard HÃ¶glund</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rikard.hoglund@ri.se" class="email">rikard.hoglund@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440 Stockholm</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
